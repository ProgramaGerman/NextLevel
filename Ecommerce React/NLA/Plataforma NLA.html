<!doctype html>
<html lang="es" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NextLevel Academy</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    .font-display {
      font-family: 'Space Grotesk', sans-serif;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    @keyframes progressBar {
      from { width: 0; }
    }
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    .animate-slide-in {
      animation: slideIn 0.4s ease-out forwards;
    }
    .animate-pulse-subtle {
      animation: pulse 2s ease-in-out infinite;
    }
    .progress-animate {
      animation: progressBar 1s ease-out forwards;
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .gradient-bg {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0d0d1f 100%);
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
    }
    .btn-primary {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
    }
    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .input-style {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    .input-style:focus {
      background: rgba(255, 255, 255, 0.1);
      border-color: #6366f1;
      outline: none;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }
    .video-container {
      position: relative;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
    }
    .video-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.5);
    }
    .star-rating {
      display: flex;
      gap: 4px;
    }
    .star {
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .star:hover {
      transform: scale(1.2);
    }
    .tab-active {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    }
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full overflow-y-auto gradient-bg text-white"></body>
  <div id="app" class="h-full overflow-auto scrollbar-hide"><!-- Loading Screen -->
   <div id="loading-screen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50">
    <div class="text-center">
     <div class="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
     <p class="text-gray-400 font-display">Cargando NextLevel Academy...</p>
    </div>
   </div><!-- Main Content -->
   <div id="main-content" class="hidden"><!-- Navigation -->
    <nav id="navbar" class="fixed top-0 left-0 right-0 z-40 glass-effect">
     <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
       <div class="flex items-center gap-2 cursor-pointer" onclick="navigateTo('home')">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center"><span class="text-xl font-bold">N</span>
        </div><span id="nav-platform-name" class="font-display font-bold text-xl hidden sm:block">NextLevel Academy</span>
       </div>
       <div class="hidden md:flex items-center gap-6"><button onclick="navigateTo('courses')" class="text-gray-300 hover:text-white transition">Cursos</button> <button onclick="navigateTo('reviews')" class="text-gray-300 hover:text-white transition">Opiniones</button> <button onclick="navigateTo('metrics')" class="text-gray-300 hover:text-white transition">M√©tricas</button>
       </div>
       <div class="flex items-center gap-3"><button id="cart-btn" onclick="navigateTo('cart')" class="relative p-2 rounded-lg btn-secondary">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
         </svg><span id="cart-count" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs flex items-center justify-center hidden">0</span> </button>
        <div id="auth-buttons" class="flex items-center gap-2"><button onclick="navigateTo('login')" class="px-4 py-2 text-sm btn-secondary rounded-lg">Iniciar Sesi√≥n</button> <button onclick="navigateTo('register')" class="px-4 py-2 text-sm btn-primary rounded-lg hidden sm:block">Registrarse</button>
        </div>
        <div id="user-menu" class="hidden items-center gap-3"><button onclick="navigateTo('dashboard')" class="flex items-center gap-2 px-3 py-2 rounded-lg btn-secondary">
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center"><span id="user-initial" class="text-sm font-bold">U</span>
          </div><span id="user-name-nav" class="hidden sm:block text-sm">Usuario</span> </button> <button onclick="logout()" class="p-2 rounded-lg btn-secondary text-red-400 hover:text-red-300">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
          </svg></button>
        </div>
       </div>
      </div>
     </div>
    </nav><!-- Page Container -->
    <div id="page-container" class="pt-16 min-h-full"><!-- HOME PAGE -->
     <div id="page-home" class="page"><!-- Hero Section -->
      <section class="relative py-20 px-4 overflow-hidden">
       <div class="absolute inset-0 overflow-hidden">
        <div class="absolute top-20 left-10 w-72 h-72 bg-indigo-500/20 rounded-full blur-3xl"></div>
        <div class="absolute bottom-20 right-10 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl"></div>
       </div>
       <div class="max-w-7xl mx-auto relative z-10">
        <div class="text-center max-w-3xl mx-auto animate-fade-in">
         <h1 id="hero-title" class="font-display text-4xl sm:text-5xl lg:text-6xl font-bold mb-6 bg-gradient-to-r from-white via-indigo-200 to-purple-200 bg-clip-text text-transparent">Eleva tu potencial al siguiente nivel</h1>
         <p id="hero-subtitle" class="text-lg sm:text-xl text-gray-400 mb-8">Cursos premium de marketing, arte, programaci√≥n y m√°s. Aprende de los mejores expertos y transforma tu carrera.</p>
         <div class="flex flex-col sm:flex-row gap-4 justify-center"><button onclick="navigateTo('courses')" class="px-8 py-4 btn-primary rounded-xl text-lg font-semibold animate-pulse-subtle"> Explorar Cursos </button> <button onclick="navigateTo('register')" class="px-8 py-4 btn-secondary rounded-xl text-lg font-semibold"> Crear Cuenta Gratis </button>
         </div>
        </div><!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-16">
         <div class="glass-effect rounded-2xl p-6 text-center card-hover">
          <div class="text-3xl font-bold text-indigo-400 font-display">
           50+
          </div>
          <div class="text-gray-400 text-sm mt-1">
           Cursos Premium
          </div>
         </div>
         <div class="glass-effect rounded-2xl p-6 text-center card-hover">
          <div class="text-3xl font-bold text-purple-400 font-display">
           10K+
          </div>
          <div class="text-gray-400 text-sm mt-1">
           Estudiantes
          </div>
         </div>
         <div class="glass-effect rounded-2xl p-6 text-center card-hover">
          <div class="text-3xl font-bold text-pink-400 font-display">
           95%
          </div>
          <div class="text-gray-400 text-sm mt-1">
           Satisfacci√≥n
          </div>
         </div>
         <div class="glass-effect rounded-2xl p-6 text-center card-hover">
          <div class="text-3xl font-bold text-cyan-400 font-display">
           24/7
          </div>
          <div class="text-gray-400 text-sm mt-1">
           Acceso Total
          </div>
         </div>
        </div>
       </div>
      </section><!-- Categories -->
      <section class="py-16 px-4">
       <div class="max-w-7xl mx-auto">
        <h2 class="font-display text-3xl font-bold text-center mb-12">Categor√≠as Populares</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4"><button onclick="filterCourses('marketing')" class="glass-effect rounded-2xl p-6 card-hover group">
          <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center mb-4 group-hover:scale-110 transition"><span class="text-2xl">üìà</span>
          </div><h3 class="font-semibold mb-1">Marketing Digital</h3><p class="text-sm text-gray-400">12 cursos</p></button> <button onclick="filterCourses('programming')" class="glass-effect rounded-2xl p-6 card-hover group">
          <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center mb-4 group-hover:scale-110 transition"><span class="text-2xl">üíª</span>
          </div><h3 class="font-semibold mb-1">Programaci√≥n</h3><p class="text-sm text-gray-400">18 cursos</p></button> <button onclick="filterCourses('art')" class="glass-effect rounded-2xl p-6 card-hover group">
          <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center mb-4 group-hover:scale-110 transition"><span class="text-2xl">üé®</span>
          </div><h3 class="font-semibold mb-1">Arte y Dise√±o</h3><p class="text-sm text-gray-400">15 cursos</p></button> <button onclick="filterCourses('visual')" class="glass-effect rounded-2xl p-6 card-hover group">
          <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center mb-4 group-hover:scale-110 transition"><span class="text-2xl">üé¨</span>
          </div><h3 class="font-semibold mb-1">Producci√≥n Visual</h3><p class="text-sm text-gray-400">10 cursos</p></button>
        </div>
       </div>
      </section><!-- Featured Courses -->
      <section class="py-16 px-4 bg-black/20">
       <div class="max-w-7xl mx-auto">
        <div class="flex items-center justify-between mb-8">
         <h2 class="font-display text-3xl font-bold">Cursos Destacados</h2><button onclick="navigateTo('courses')" class="text-indigo-400 hover:text-indigo-300 flex items-center gap-2"> Ver todos 
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg></button>
        </div>
        <div id="featured-courses" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Courses will be rendered here -->
        </div>
       </div>
      </section>
     </div><!-- COURSES PAGE -->
     <div id="page-courses" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
         <h1 class="font-display text-3xl font-bold">Explora Nuestros Cursos</h1>
         <div class="flex gap-2 flex-wrap"><button onclick="filterCourses('all')" class="px-4 py-2 rounded-lg btn-secondary text-sm filter-btn active" data-filter="all">Todos</button> <button onclick="filterCourses('marketing')" class="px-4 py-2 rounded-lg btn-secondary text-sm filter-btn" data-filter="marketing">Marketing</button> <button onclick="filterCourses('programming')" class="px-4 py-2 rounded-lg btn-secondary text-sm filter-btn" data-filter="programming">Programaci√≥n</button> <button onclick="filterCourses('art')" class="px-4 py-2 rounded-lg btn-secondary text-sm filter-btn" data-filter="art">Arte</button> <button onclick="filterCourses('visual')" class="px-4 py-2 rounded-lg btn-secondary text-sm filter-btn" data-filter="visual">Visual</button>
         </div>
        </div>
        <div id="courses-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Courses will be rendered here -->
        </div>
       </div>
      </div>
     </div><!-- CART PAGE -->
     <div id="page-cart" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-4xl mx-auto">
        <h1 class="font-display text-3xl font-bold mb-8">Tu Carrito</h1>
        <div id="cart-empty" class="glass-effect rounded-2xl p-12 text-center hidden">
         <div class="text-6xl mb-4">
          üõí
         </div>
         <h3 class="text-xl font-semibold mb-2">Tu carrito est√° vac√≠o</h3>
         <p class="text-gray-400 mb-6">Explora nuestros cursos y a√±ade los que m√°s te interesen</p><button onclick="navigateTo('courses')" class="px-6 py-3 btn-primary rounded-xl">Explorar Cursos</button>
        </div>
        <div id="cart-content" class="hidden">
         <div id="cart-items" class="space-y-4 mb-6"><!-- Cart items will be rendered here -->
         </div>
         <div class="glass-effect rounded-2xl p-6">
          <div class="flex justify-between items-center mb-4"><span class="text-gray-400">Subtotal:</span> <span id="cart-subtotal" class="text-xl font-bold">$0.00</span>
          </div><button onclick="navigateTo('checkout')" class="w-full py-4 btn-primary rounded-xl text-lg font-semibold">Proceder al Pago</button>
         </div>
        </div>
       </div>
      </div>
     </div><!-- CHECKOUT PAGE -->
     <div id="page-checkout" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-4xl mx-auto">
        <h1 class="font-display text-3xl font-bold mb-8">Finalizar Compra</h1>
        <div class="grid lg:grid-cols-2 gap-8"><!-- Payment Form -->
         <div class="glass-effect rounded-2xl p-6">
          <h2 class="text-xl font-semibold mb-6">Informaci√≥n del Comprador</h2>
          <form id="checkout-form" onsubmit="processPayment(event)" class="space-y-4">
           <div class="grid grid-cols-2 gap-4">
            <div><label class="block text-sm text-gray-400 mb-2">Nombre</label> <input type="text" id="checkout-name" required class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="Tu nombre">
            </div>
            <div><label class="block text-sm text-gray-400 mb-2">Apellido</label> <input type="text" id="checkout-lastname" required class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="Tu apellido">
            </div>
           </div>
           <div><label class="block text-sm text-gray-400 mb-2">C√©dula</label> <input type="text" id="checkout-cedula" required class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="V-12345678">
           </div>
           <div><label class="block text-sm text-gray-400 mb-2">M√©todo de Pago</label>
            <div class="grid grid-cols-2 gap-3"><button type="button" onclick="selectPaymentMethod('pago_movil')" class="payment-method p-4 rounded-xl btn-secondary text-left" data-method="pago_movil">
              <div class="text-2xl mb-2">
               üì±
              </div>
              <div class="font-semibold">
               Pago M√≥vil
              </div>
              <div class="text-xs text-gray-400">
               Venezuela
              </div></button> <button type="button" onclick="selectPaymentMethod('transferencia')" class="payment-method p-4 rounded-xl btn-secondary text-left" data-method="transferencia">
              <div class="text-2xl mb-2">
               üè¶
              </div>
              <div class="font-semibold">
               Transferencia
              </div>
              <div class="text-xs text-gray-400">
               Bancaria
              </div></button> <button type="button" onclick="selectPaymentMethod('paypal')" class="payment-method p-4 rounded-xl btn-secondary text-left" data-method="paypal">
              <div class="text-2xl mb-2">
               üí≥
              </div>
              <div class="font-semibold">
               PayPal
              </div>
              <div class="text-xs text-gray-400">
               Internacional
              </div></button> <button type="button" onclick="selectPaymentMethod('divisas')" class="payment-method p-4 rounded-xl btn-secondary text-left" data-method="divisas">
              <div class="text-2xl mb-2">
               üíµ
              </div>
              <div class="font-semibold">
               Divisas
              </div>
              <div class="text-xs text-gray-400">
               USD / EUR
              </div></button>
            </div>
           </div><!-- Payment Details based on method -->
           <div id="payment-details" class="hidden space-y-4 p-4 rounded-xl bg-white/5">
            <div id="pago-movil-details" class="payment-detail hidden">
             <p class="text-sm text-gray-400 mb-2">Datos para Pago M√≥vil:</p>
             <div class="bg-black/30 rounded-lg p-3 text-sm space-y-1">
              <p><span class="text-gray-400">Banco:</span> Banesco</p>
              <p><span class="text-gray-400">Tel√©fono:</span> 0414-1234567</p>
              <p><span class="text-gray-400">C√©dula:</span> V-12345678</p>
             </div><input type="text" id="pago-movil-ref" class="w-full mt-3 px-4 py-3 rounded-xl input-style text-white" placeholder="N√∫mero de referencia">
            </div>
            <div id="transferencia-details" class="payment-detail hidden">
             <p class="text-sm text-gray-400 mb-2">Datos para Transferencia:</p>
             <div class="bg-black/30 rounded-lg p-3 text-sm space-y-1">
              <p><span class="text-gray-400">Banco:</span> Banesco</p>
              <p><span class="text-gray-400">Cuenta:</span> 0134-0123-45-1234567890</p>
              <p><span class="text-gray-400">RIF:</span> J-12345678-9</p>
             </div><input type="text" id="transferencia-ref" class="w-full mt-3 px-4 py-3 rounded-xl input-style text-white" placeholder="N√∫mero de referencia">
            </div>
            <div id="paypal-details" class="payment-detail hidden">
             <p class="text-sm text-gray-400 mb-2">Pago con PayPal:</p>
             <div class="bg-black/30 rounded-lg p-3 text-sm">
              <p><span class="text-gray-400">Enviar a:</span> pagos@nextlevel.academy</p>
             </div><input type="email" id="paypal-email" class="w-full mt-3 px-4 py-3 rounded-xl input-style text-white" placeholder="Tu email de PayPal">
            </div>
            <div id="divisas-details" class="payment-detail hidden">
             <p class="text-sm text-gray-400 mb-2">Pago en Divisas:</p>
             <div class="bg-black/30 rounded-lg p-3 text-sm space-y-1">
              <p><span class="text-gray-400">Zelle:</span> pagos@nextlevel.academy</p>
              <p><span class="text-gray-400">Tasa:</span> $1 = Bs. 45.00</p>
             </div><select id="divisa-type" class="w-full mt-3 px-4 py-3 rounded-xl input-style text-white"> <option value="usd">USD - DÔøΩÔøΩÔøΩÔøΩlar Americano</option> <option value="eur">EUR - Euro</option> </select>
            </div>
           </div><button type="submit" id="checkout-submit" class="w-full py-4 btn-primary rounded-xl text-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled> <span id="checkout-btn-text">Selecciona un m√©todo de pago</span> </button>
          </form>
         </div><!-- Order Summary -->
         <div>
          <div class="glass-effect rounded-2xl p-6 sticky top-24">
           <h2 class="text-xl font-semibold mb-6">Resumen del Pedido</h2>
           <div id="checkout-items" class="space-y-4 mb-6 max-h-64 overflow-auto scrollbar-hide"><!-- Checkout items will be rendered here -->
           </div>
           <div class="border-t border-white/10 pt-4 space-y-2">
            <div class="flex justify-between text-gray-400"><span>Subtotal</span> <span id="checkout-subtotal">$0.00</span>
            </div>
            <div class="flex justify-between text-gray-400"><span>Impuestos</span> <span>$0.00</span>
            </div>
            <div class="flex justify-between text-xl font-bold pt-2"><span>Total</span> <span id="checkout-total">$0.00</span>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- LOGIN PAGE -->
     <div id="page-login" class="page hidden">
      <div class="min-h-[calc(100%-4rem)] flex items-center justify-center py-12 px-4">
       <div class="w-full max-w-md">
        <div class="glass-effect rounded-3xl p-8 animate-fade-in">
         <div class="text-center mb-8">
          <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mx-auto mb-4"><span class="text-3xl font-bold">N</span>
          </div>
          <h1 class="font-display text-2xl font-bold">Bienvenido de vuelta</h1>
          <p class="text-gray-400 mt-2">Ingresa a tu cuenta para continuar</p>
         </div>
         <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4">
          <div><label class="block text-sm text-gray-400 mb-2">C√©dula</label> <input type="text" id="login-cedula" required class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="V-12345678">
          </div>
          <div><label class="block text-sm text-gray-400 mb-2">Contrase√±a</label> <input type="password" id="login-password" required class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <div id="login-error" class="hidden text-red-400 text-sm text-center p-3 bg-red-500/10 rounded-lg"></div><button type="submit" id="login-submit" class="w-full py-4 btn-primary rounded-xl text-lg font-semibold"> <span id="login-btn-text">Iniciar Sesi√≥n</span> </button>
         </form>
         <p class="text-center text-gray-400 mt-6">¬øNo tienes cuenta? <button onclick="navigateTo('register')" class="text-indigo-400 hover:text-indigo-300">Reg√≠strate</button></p>
        </div>
       </div>
      </div>
     </div><!-- REGISTER PAGE -->
     <div id="page-register" class="page hidden">
      <div class="min-h-[calc(100%-4rem)] flex items-center justify-center py-12 px-4">
       <div class="w-full max-w-md">
        <div class="glass-effect rounded-3xl p-8 animate-fade-in">
         <div class="text-center mb-8">
          <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mx-auto mb-4"><span class="text-3xl font-bold">N</span>
          </div>
          <h1 class="font-display text-2xl font-bold">Crear Cuenta</h1>
          <p class="text-gray-400 mt-2">√önete a nuestra comunidad de aprendizaje</p>
         </div>
         <form id="register-form" onsubmit="handleRegister(event)" class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
           <div><label class="block text-sm text-gray-400 mb-2">Nombre</label> <input type="text" id="register-name" required class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="Tu nombre">
           </div>
           <div><label class="block text-sm text-gray-400 mb-2">Apellido</label> <input type="text" id="register-lastname" required class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="Tu apellido">
           </div>
          </div>
          <div><label class="block text-sm text-gray-400 mb-2">C√©dula</label> <input type="text" id="register-cedula" required class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="V-12345678">
          </div>
          <div><label class="block text-sm text-gray-400 mb-2">Contrase√±a</label> <input type="password" id="register-password" required minlength="6" class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="M√≠nimo 6 caracteres">
          </div>
          <div><label class="block text-sm text-gray-400 mb-2">Confirmar Contrase√±a</label> <input type="password" id="register-confirm" required class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <div id="register-error" class="hidden text-red-400 text-sm text-center p-3 bg-red-500/10 rounded-lg"></div>
          <div id="register-success" class="hidden text-green-400 text-sm text-center p-3 bg-green-500/10 rounded-lg"></div><button type="submit" id="register-submit" class="w-full py-4 btn-primary rounded-xl text-lg font-semibold"> <span id="register-btn-text">Crear Cuenta</span> </button>
         </form>
         <p class="text-center text-gray-400 mt-6">¬øYa tienes cuenta? <button onclick="navigateTo('login')" class="text-indigo-400 hover:text-indigo-300">Inicia Sesi√≥n</button></p>
        </div>
       </div>
      </div>
     </div><!-- DASHBOARD PAGE -->
     <div id="page-dashboard" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-7xl mx-auto"><!-- Welcome Header -->
        <div class="glass-effect rounded-3xl p-8 mb-8 animate-fade-in">
         <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
          <div>
           <h1 class="font-display text-3xl font-bold mb-2">Hola, <span id="dashboard-user-name">Usuario</span> üëã</h1>
           <p class="text-gray-400">Contin√∫a tu camino de aprendizaje</p>
          </div><button onclick="navigateTo('profile')" class="px-6 py-3 btn-secondary rounded-xl flex items-center gap-2">
           <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
           </svg> Ver Perfil </button>
         </div>
        </div><!-- Stats Cards -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
         <div class="glass-effect rounded-2xl p-6 card-hover">
          <div class="text-3xl font-bold text-indigo-400 font-display" id="stat-in-progress">
           0
          </div>
          <div class="text-gray-400 text-sm mt-1">
           En Progreso
          </div>
         </div>
         <div class="glass-effect rounded-2xl p-6 card-hover">
          <div class="text-3xl font-bold text-green-400 font-display" id="stat-completed">
           0
          </div>
          <div class="text-gray-400 text-sm mt-1">
           Completados
          </div>
         </div>
         <div class="glass-effect rounded-2xl p-6 card-hover">
          <div class="text-3xl font-bold text-purple-400 font-display" id="stat-not-started">
           0
          </div>
          <div class="text-gray-400 text-sm mt-1">
           Por Empezar
          </div>
         </div>
         <div class="glass-effect rounded-2xl p-6 card-hover">
          <div class="text-3xl font-bold text-yellow-400 font-display" id="stat-avg-score">
           0%
          </div>
          <div class="text-gray-400 text-sm mt-1">
           Promedio
          </div>
         </div>
        </div><!-- Course Tabs -->
        <div class="flex gap-2 mb-6 overflow-x-auto scrollbar-hide pb-2"><button onclick="filterDashboardCourses('all')" class="px-6 py-3 rounded-xl whitespace-nowrap dashboard-tab tab-active" data-tab="all">Todos</button> <button onclick="filterDashboardCourses('in_progress')" class="px-6 py-3 rounded-xl whitespace-nowrap dashboard-tab btn-secondary" data-tab="in_progress">En Progreso</button> <button onclick="filterDashboardCourses('completed')" class="px-6 py-3 rounded-xl whitespace-nowrap dashboard-tab btn-secondary" data-tab="completed">Completados</button> <button onclick="filterDashboardCourses('not_started')" class="px-6 py-3 rounded-xl whitespace-nowrap dashboard-tab btn-secondary" data-tab="not_started">Por Empezar</button>
        </div><!-- User Courses -->
        <div id="dashboard-courses" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- User courses will be rendered here -->
        </div>
        <div id="no-courses-msg" class="glass-effect rounded-2xl p-12 text-center hidden">
         <div class="text-6xl mb-4">
          üìö
         </div>
         <h3 class="text-xl font-semibold mb-2">No tienes cursos a√∫n</h3>
         <p class="text-gray-400 mb-6">Explora nuestro cat√°logo y comienza tu aprendizaje</p><button onclick="navigateTo('courses')" class="px-6 py-3 btn-primary rounded-xl">Explorar Cursos</button>
        </div>
       </div>
      </div>
     </div><!-- PROFILE PAGE -->
     <div id="page-profile" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-4xl mx-auto">
        <h1 class="font-display text-3xl font-bold mb-8">Mi Perfil</h1>
        <div class="grid lg:grid-cols-3 gap-8"><!-- Profile Card -->
         <div class="glass-effect rounded-3xl p-8 text-center">
          <div class="w-24 h-24 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mx-auto mb-4"><span id="profile-initial" class="text-4xl font-bold">U</span>
          </div>
          <h2 id="profile-fullname" class="text-xl font-bold">Usuario</h2>
          <p id="profile-cedula" class="text-gray-400">V-00000000</p>
          <div class="mt-6 pt-6 border-t border-white/10">
           <div class="text-sm text-gray-400">
            Miembro desde
           </div>
           <div id="profile-since" class="font-semibold">
            --
           </div>
          </div>
         </div><!-- Stats -->
         <div class="lg:col-span-2 space-y-6">
          <div class="glass-effect rounded-2xl p-6">
           <h3 class="text-lg font-semibold mb-4">Acciones R√°pidas</h3>
           <div class="grid grid-cols-2 gap-3"><button onclick="navigateTo('payment-methods')" class="p-4 btn-secondary rounded-xl hover:bg-indigo-500/20 transition flex flex-col items-center gap-2"> <span class="text-2xl">üí≥</span> <span class="text-sm">M√©todos de Pago</span> </button> <button onclick="navigateTo('payment-history')" class="p-4 btn-secondary rounded-xl hover:bg-indigo-500/20 transition flex flex-col items-center gap-2"> <span class="text-2xl">üìã</span> <span class="text-sm">Historial Pagos</span> </button>
           </div>
          </div>
          <div class="glass-effect rounded-2xl p-6">
           <h3 class="text-lg font-semibold mb-4">Estad√≠sticas de Aprendizaje</h3>
           <div class="grid grid-cols-2 gap-4">
            <div class="bg-white/5 rounded-xl p-4">
             <div class="text-2xl font-bold text-indigo-400" id="profile-total-courses">
              0
             </div>
             <div class="text-sm text-gray-400">
              Cursos Totales
             </div>
            </div>
            <div class="bg-white/5 rounded-xl p-4">
             <div class="text-2xl font-bold text-green-400" id="profile-completed-courses">
              0
             </div>
             <div class="text-sm text-gray-400">
              Completados
             </div>
            </div>
            <div class="bg-white/5 rounded-xl p-4">
             <div class="text-2xl font-bold text-yellow-400" id="profile-avg-score">
              0%
             </div>
             <div class="text-sm text-gray-400">
              Promedio General
             </div>
            </div>
            <div class="bg-white/5 rounded-xl p-4">
             <div class="text-2xl font-bold text-purple-400" id="profile-hours">
              0h
             </div>
             <div class="text-sm text-gray-400">
              Horas de Estudio
             </div>
            </div>
           </div>
          </div>
          <div class="glass-effect rounded-2xl p-6">
           <h3 class="text-lg font-semibold mb-4">Progreso por Categor√≠a</h3>
           <div class="space-y-4">
            <div>
             <div class="flex justify-between text-sm mb-1"><span>Marketing Digital</span> <span id="progress-marketing">0%</span>
             </div>
             <div class="h-2 bg-white/10 rounded-full overflow-hidden">
              <div id="bar-marketing" class="h-full bg-gradient-to-r from-orange-500 to-red-500 progress-animate" style="width: 0%"></div>
             </div>
            </div>
            <div>
             <div class="flex justify-between text-sm mb-1"><span>Programaci√≥n</span> <span id="progress-programming">0%</span>
             </div>
             <div class="h-2 bg-white/10 rounded-full overflow-hidden">
              <div id="bar-programming" class="h-full bg-gradient-to-r from-blue-500 to-cyan-500 progress-animate" style="width: 0%"></div>
             </div>
            </div>
            <div>
             <div class="flex justify-between text-sm mb-1"><span>Arte y Dise√±o</span> <span id="progress-art">0%</span>
             </div>
             <div class="h-2 bg-white/10 rounded-full overflow-hidden">
              <div id="bar-art" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 progress-animate" style="width: 0%"></div>
             </div>
            </div>
            <div>
             <div class="flex justify-between text-sm mb-1"><span>Producci√≥n Visual</span> <span id="progress-visual">0%</span>
             </div>
             <div class="h-2 bg-white/10 rounded-full overflow-hidden">
              <div id="bar-visual" class="h-full bg-gradient-to-r from-green-500 to-emerald-500 progress-animate" style="width: 0%"></div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- COURSE DETAIL / LEARNING PAGE -->
     <div id="page-course" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-6xl mx-auto"><button onclick="navigateTo('dashboard')" class="flex items-center gap-2 text-gray-400 hover:text-white mb-6 transition">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
         </svg> Volver al Dashboard </button>
        <div class="grid lg:grid-cols-3 gap-8"><!-- Main Content -->
         <div class="lg:col-span-2 space-y-6"><!-- Video Player -->
          <div class="glass-effect rounded-2xl overflow-hidden">
           <div class="video-container aspect-video bg-gray-900">
            <div id="video-placeholder" class="w-full h-full flex items-center justify-center">
             <div class="text-center">
              <div class="text-6xl mb-4">
               üé¨
              </div>
              <p class="text-gray-400">Simulaci√≥n de Video</p>
             </div>
            </div>
            <div id="video-playing" class="hidden w-full h-full">
             <div class="video-overlay"><button id="video-pause-btn" onclick="toggleVideo()" class="w-20 h-20 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition">
               <svg class="w-10 h-10" fill="currentColor" viewbox="0 0 24 24"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" />
               </svg></button>
             </div>
             <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80">
              <div class="flex items-center gap-4">
               <div class="flex-1 h-1 bg-white/20 rounded-full overflow-hidden">
                <div id="video-progress" class="h-full bg-indigo-500 transition-all duration-1000" style="width: 0%"></div>
               </div><span id="video-time" class="text-sm">0:00 / 5:00</span>
              </div>
             </div>
            </div>
           </div>
           <div class="p-6">
            <h1 id="course-title" class="font-display text-2xl font-bold mb-2">T√≠tulo del Curso</h1>
            <p id="course-description" class="text-gray-400">Descripci√≥n del curso</p>
           </div>
          </div><!-- Lesson Content -->
          <div class="glass-effect rounded-2xl p-6">
           <h2 class="text-xl font-semibold mb-4">Contenido de la Lecci√≥n</h2>
           <div id="lesson-content" class="text-gray-300 space-y-4">
            <p>Bienvenido a esta lecci√≥n. En este m√≥dulo aprender√°s conceptos fundamentales que te ayudar√°n a dominar el tema.</p>
            <ul class="list-disc list-inside space-y-2">
             <li>Fundamentos y teor√≠a b√°sica</li>
             <li>Aplicaciones pr√°cticas</li>
             <li>Casos de estudio reales</li>
             <li>Mejores pr√°cticas del sector</li>
            </ul>
           </div>
          </div>
         </div><!-- Sidebar -->
         <div class="space-y-6"><!-- Course Progress -->
          <div class="glass-effect rounded-2xl p-6">
           <h3 class="font-semibold mb-4">Tu Progreso</h3>
           <div class="relative w-32 h-32 mx-auto mb-4">
            <svg class="w-full h-full transform -rotate-90"><circle cx="64" cy="64" r="56" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="12" /> <circle id="progress-circle" cx="64" cy="64" r="56" fill="none" stroke="url(#progressGradient)" stroke-width="12" stroke-linecap="round" stroke-dasharray="352" stroke-dashoffset="352" /> <defs>
              <lineargradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
               <stop offset="0%" stop-color="#6366f1" />
               <stop offset="100%" stop-color="#8b5cf6" />
              </lineargradient>
             </defs>
            </svg>
            <div class="absolute inset-0 flex items-center justify-center"><span id="progress-percent" class="text-2xl font-bold">0%</span>
            </div>
           </div>
           <div class="space-y-3"><button id="start-lesson-btn" onclick="startLesson()" class="w-full py-3 btn-primary rounded-xl font-semibold"> Iniciar Lecci√≥n </button> <button id="take-quiz-btn" onclick="startQuiz()" class="w-full py-3 btn-secondary rounded-xl font-semibold hidden"> Tomar Prueba </button>
           </div>
          </div><!-- Lessons List -->
          <div class="glass-effect rounded-2xl p-6">
           <h3 class="font-semibold mb-4">Lecciones</h3>
           <div id="lessons-list" class="space-y-2"><!-- Lessons will be rendered here -->
           </div>
          </div>
         </div>
        </div><!-- Comments Section -->
        <div class="mt-8">
         <div class="glass-effect rounded-2xl p-6">
          <h2 class="text-2xl font-semibold mb-6">Comentarios y Calificaciones</h2><!-- Add Comment Form -->
          <div id="add-comment-section" class="hidden mb-8 p-6 bg-white/5 rounded-2xl">
           <h3 class="font-semibold mb-4">Comparte tu opini√≥n</h3>
           <form id="comment-form" onsubmit="submitCourseComment(event)" class="space-y-4">
            <div><label class="block text-sm text-gray-400 mb-2">Tu Calificaci√≥n</label>
             <div class="flex gap-2" id="course-rating-input"><button type="button" onclick="setCourseRating(1)" class="star text-3xl text-gray-500 hover:text-yellow-400 transition" data-rating="1">‚òÖ</button> <button type="button" onclick="setCourseRating(2)" class="star text-3xl text-gray-500 hover:text-yellow-400 transition" data-rating="2">‚òÖ</button> <button type="button" onclick="setCourseRating(3)" class="star text-3xl text-gray-500 hover:text-yellow-400 transition" data-rating="3">‚òÖ</button> <button type="button" onclick="setCourseRating(4)" class="star text-3xl text-gray-500 hover:text-yellow-400 transition" data-rating="4">‚òÖ</button> <button type="button" onclick="setCourseRating(5)" class="star text-3xl text-gray-500 hover:text-yellow-400 transition" data-rating="5">‚òÖ</button>
             </div>
            </div>
            <div><label class="block text-sm text-gray-400 mb-2">Tu Comentario</label> <textarea id="course-comment-text" required rows="4" maxlength="500" class="w-full px-4 py-3 rounded-xl input-style text-white resize-none" placeholder="Comparte tu experiencia con este curso..."></textarea>
             <div class="text-xs text-gray-400 mt-1"><span id="char-count">0</span>/500
             </div>
            </div><button type="submit" id="comment-submit" class="px-6 py-3 btn-primary rounded-xl font-semibold"> Publicar Comentario </button>
           </form>
          </div><!-- Login to Comment Message -->
          <div id="login-to-comment" class="hidden mb-8 text-center p-6 bg-white/5 rounded-2xl">
           <p class="text-gray-400 mb-3">Inicia sesi√≥n para dejar un comentario</p><button onclick="navigateTo('login')" class="px-6 py-2 btn-primary rounded-xl text-sm">Iniciar Sesi√≥n</button>
          </div><!-- Course Rating Summary -->
          <div id="course-rating-summary" class="mb-8 p-6 bg-white/5 rounded-2xl hidden">
           <div class="flex items-center gap-4 mb-4">
            <div class="text-center">
             <div class="text-3xl font-bold text-yellow-400 font-display" id="course-avg-rating">
              0.0
             </div>
             <div class="flex justify-center gap-1 mt-1" id="course-avg-stars"></div>
             <p class="text-sm text-gray-400 mt-2"><span id="course-total-ratings">0</span> calificaciones</p>
            </div>
            <div class="flex-1">
             <div id="course-rating-bars" class="space-y-2"><!-- Rating bars will be rendered here -->
             </div>
            </div>
           </div>
          </div><!-- Comments List -->
          <div id="course-comments-container" class="space-y-4">
           <div id="no-comments" class="text-center p-8 bg-white/5 rounded-xl">
            <div class="text-4xl mb-3">
             üí¨
            </div>
            <p class="text-gray-400">A√∫n no hay comentarios en este curso</p>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- QUIZ PAGE -->
     <div id="page-quiz" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-3xl mx-auto">
        <div class="glass-effect rounded-3xl p-8">
         <div id="quiz-header" class="text-center mb-8">
          <h1 class="font-display text-2xl font-bold mb-2">Prueba de Evaluaci√≥n</h1>
          <p id="quiz-course-title" class="text-gray-400">Curso</p>
         </div>
         <div id="quiz-progress" class="mb-8">
          <div class="flex justify-between text-sm mb-2"><span>Pregunta <span id="quiz-current">1</span> de <span id="quiz-total">5</span></span> <span id="quiz-timer" class="text-indigo-400">‚è±Ô∏è 5:00</span>
          </div>
          <div class="h-2 bg-white/10 rounded-full overflow-hidden">
           <div id="quiz-progress-bar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all" style="width: 20%"></div>
          </div>
         </div>
         <div id="quiz-content">
          <div id="quiz-question" class="text-xl font-semibold mb-6">
           Pregunta de ejemplo
          </div>
          <div id="quiz-options" class="space-y-3"><!-- Options will be rendered here -->
          </div>
         </div>
         <div id="quiz-navigation" class="flex justify-between mt-8"><button id="quiz-prev" onclick="prevQuestion()" class="px-6 py-3 btn-secondary rounded-xl disabled:opacity-50" disabled>Anterior</button> <button id="quiz-next" onclick="nextQuestion()" class="px-6 py-3 btn-primary rounded-xl">Siguiente</button> <button id="quiz-submit" onclick="submitQuiz()" class="px-6 py-3 btn-primary rounded-xl hidden">Enviar Respuestas</button>
         </div>
        </div>
       </div>
      </div>
     </div><!-- QUIZ RESULTS PAGE -->
     <div id="page-results" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-2xl mx-auto">
        <div class="glass-effect rounded-3xl p-8 text-center animate-fade-in">
         <div id="results-icon" class="text-7xl mb-4">
          üéâ
         </div>
         <h1 class="font-display text-3xl font-bold mb-2">¬°Prueba Completada!</h1>
         <p id="results-course" class="text-gray-400 mb-8">Curso</p>
         <div class="relative w-40 h-40 mx-auto mb-8">
          <svg class="w-full h-full transform -rotate-90"><circle cx="80" cy="80" r="70" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="14" /> <circle id="results-circle" cx="80" cy="80" r="70" fill="none" stroke="url(#resultsGradient)" stroke-width="14" stroke-linecap="round" stroke-dasharray="440" stroke-dashoffset="440" /> <defs>
            <lineargradient id="resultsGradient" x1="0%" y1="0%" x2="100%" y2="0%">
             <stop offset="0%" stop-color="#10b981" />
             <stop offset="100%" stop-color="#34d399" />
            </lineargradient>
           </defs>
          </svg>
          <div class="absolute inset-0 flex flex-col items-center justify-center"><span id="results-score" class="text-4xl font-bold">0%</span> <span class="text-sm text-gray-400">Calificaci√≥n</span>
          </div>
         </div>
         <div class="grid grid-cols-3 gap-4 mb-8">
          <div class="bg-white/5 rounded-xl p-4">
           <div id="results-correct" class="text-2xl font-bold text-green-400">
            0
           </div>
           <div class="text-sm text-gray-400">
            Correctas
           </div>
          </div>
          <div class="bg-white/5 rounded-xl p-4">
           <div id="results-incorrect" class="text-2xl font-bold text-red-400">
            0
           </div>
           <div class="text-sm text-gray-400">
            Incorrectas
           </div>
          </div>
          <div class="bg-white/5 rounded-xl p-4">
           <div id="results-time" class="text-2xl font-bold text-indigo-400">
            0:00
           </div>
           <div class="text-sm text-gray-400">
            Tiempo
           </div>
          </div>
         </div>
         <div id="results-message" class="p-4 rounded-xl bg-green-500/10 text-green-400 mb-8">
          ¬°Excelente trabajo! Has aprobado el curso.
         </div>
         <div class="flex gap-4 justify-center"><button onclick="navigateTo('dashboard')" class="px-6 py-3 btn-secondary rounded-xl">Ir al Dashboard</button> <button onclick="navigateTo('courses')" class="px-6 py-3 btn-primary rounded-xl">Explorar M√°s Cursos</button>
         </div>
        </div>
       </div>
      </div>
     </div><!-- REVIEWS PAGE -->
     <div id="page-reviews" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-4xl mx-auto">
        <h1 class="font-display text-3xl font-bold mb-8">Opiniones y Calificaciones</h1><!-- Overall Rating -->
        <div class="glass-effect rounded-3xl p-8 mb-8">
         <div class="grid md:grid-cols-2 gap-8 items-center">
          <div class="text-center">
           <div class="text-6xl font-bold text-yellow-400 font-display" id="overall-rating">
            4.8
           </div>
           <div class="flex justify-center gap-1 my-3" id="overall-stars"><!-- Stars will be rendered here -->
           </div>
           <p class="text-gray-400"><span id="total-reviews">0</span> opiniones</p>
          </div>
          <div class="space-y-3">
           <div class="flex items-center gap-3"><span class="text-sm w-8">5 ‚≠ê</span>
            <div class="flex-1 h-3 bg-white/10 rounded-full overflow-hidden">
             <div id="rating-5-bar" class="h-full bg-yellow-400" style="width: 70%"></div>
            </div><span id="rating-5-count" class="text-sm text-gray-400 w-8">0</span>
           </div>
           <div class="flex items-center gap-3"><span class="text-sm w-8">4 ‚≠ê</span>
            <div class="flex-1 h-3 bg-white/10 rounded-full overflow-hidden">
             <div id="rating-4-bar" class="h-full bg-yellow-400" style="width: 20%"></div>
            </div><span id="rating-4-count" class="text-sm text-gray-400 w-8">0</span>
           </div>
           <div class="flex items-center gap-3"><span class="text-sm w-8">3 ‚≠ê</span>
            <div class="flex-1 h-3 bg-white/10 rounded-full overflow-hidden">
             <div id="rating-3-bar" class="h-full bg-yellow-400" style="width: 7%"></div>
            </div><span id="rating-3-count" class="text-sm text-gray-400 w-8">0</span>
           </div>
           <div class="flex items-center gap-3"><span class="text-sm w-8">2 ‚≠ê</span>
            <div class="flex-1 h-3 bg-white/10 rounded-full overflow-hidden">
             <div id="rating-2-bar" class="h-full bg-yellow-400" style="width: 2%"></div>
            </div><span id="rating-2-count" class="text-sm text-gray-400 w-8">0</span>
           </div>
           <div class="flex items-center gap-3"><span class="text-sm w-8">1 ‚≠ê</span>
            <div class="flex-1 h-3 bg-white/10 rounded-full overflow-hidden">
             <div id="rating-1-bar" class="h-full bg-yellow-400" style="width: 1%"></div>
            </div><span id="rating-1-count" class="text-sm text-gray-400 w-8">0</span>
           </div>
          </div>
         </div>
        </div><!-- Add Review Form -->
        <div id="add-review-section" class="glass-effect rounded-2xl p-6 mb-8 hidden">
         <h2 class="text-xl font-semibold mb-4">Deja tu Opini√≥n</h2>
         <form id="review-form" onsubmit="submitReview(event)" class="space-y-4">
          <div><label class="block text-sm text-gray-400 mb-2">Tu Calificaci√≥n</label>
           <div class="flex gap-2" id="rating-input"><button type="button" onclick="setRating(1)" class="star text-3xl text-gray-500 hover:text-yellow-400" data-rating="1">‚òÖ</button> <button type="button" onclick="setRating(2)" class="star text-3xl text-gray-500 hover:text-yellow-400" data-rating="2">‚òÖ</button> <button type="button" onclick="setRating(3)" class="star text-3xl text-gray-500 hover:text-yellow-400" data-rating="3">‚òÖ</button> <button type="button" onclick="setRating(4)" class="star text-3xl text-gray-500 hover:text-yellow-400" data-rating="4">‚òÖ</button> <button type="button" onclick="setRating(5)" class="star text-3xl text-gray-500 hover:text-yellow-400" data-rating="5">‚òÖ</button>
           </div>
          </div>
          <div><label class="block text-sm text-gray-400 mb-2">Tu Comentario</label> <textarea id="review-comment" required rows="4" class="w-full px-4 py-3 rounded-xl input-style text-white resize-none" placeholder="Cu√©ntanos tu experiencia..."></textarea>
          </div><button type="submit" id="review-submit" class="px-6 py-3 btn-primary rounded-xl font-semibold"> Enviar Opini√≥n </button>
         </form>
        </div>
        <div id="login-to-review" class="glass-effect rounded-2xl p-6 mb-8 text-center">
         <p class="text-gray-400 mb-4">Inicia sesi√≥n para dejar tu opini√≥n</p><button onclick="navigateTo('login')" class="px-6 py-3 btn-primary rounded-xl">Iniciar Sesi√≥n</button>
        </div><!-- Reviews List -->
        <div class="space-y-4">
         <h2 class="text-xl font-semibold">Opiniones de la Comunidad</h2>
         <div id="reviews-list" class="space-y-4"><!-- Reviews will be rendered here -->
         </div>
         <div id="no-reviews" class="glass-effect rounded-2xl p-8 text-center hidden">
          <div class="text-4xl mb-3">
           üí¨
          </div>
          <p class="text-gray-400">A√∫n no hay opiniones. ¬°S√© el primero en opinar!</p>
         </div>
        </div>
       </div>
      </div>
     </div><!-- METRICS PAGE -->
     <div id="page-metrics" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-7xl mx-auto">
        <h1 class="font-display text-3xl font-bold mb-8">M√©tricas de la Plataforma</h1><!-- Main Stats -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
         <div class="glass-effect rounded-2xl p-6 card-hover">
          <div class="flex items-center gap-3 mb-3">
           <div class="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center"><span class="text-2xl">üë•</span>
           </div>
          </div>
          <div class="text-3xl font-bold font-display" id="metric-users">
           0
          </div>
          <div class="text-gray-400 text-sm">
           Usuarios Registrados
          </div>
         </div>
         <div class="glass-effect rounded-2xl p-6 card-hover">
          <div class="flex items-center gap-3 mb-3">
           <div class="w-12 h-12 rounded-xl bg-green-500/20 flex items-center justify-center"><span class="text-2xl">üìö</span>
           </div>
          </div>
          <div class="text-3xl font-bold font-display" id="metric-enrollments">
           0
          </div>
          <div class="text-gray-400 text-sm">
           Cursos Inscritos
          </div>
         </div>
         <div class="glass-effect rounded-2xl p-6 card-hover">
          <div class="flex items-center gap-3 mb-3">
           <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center"><span class="text-2xl">‚úÖ</span>
           </div>
          </div>
          <div class="text-3xl font-bold font-display" id="metric-completions">
           0
          </div>
          <div class="text-gray-400 text-sm">
           Cursos Completados
          </div>
         </div>
         <div class="glass-effect rounded-2xl p-6 card-hover">
          <div class="flex items-center gap-3 mb-3">
           <div class="w-12 h-12 rounded-xl bg-yellow-500/20 flex items-center justify-center"><span class="text-2xl">‚≠ê</span>
           </div>
          </div>
          <div class="text-3xl font-bold font-display" id="metric-avg-rating">
           0.0
          </div>
          <div class="text-gray-400 text-sm">
           Calificaci√≥n Promedio
          </div>
         </div>
        </div><!-- Charts Section -->
        <div class="grid lg:grid-cols-2 gap-6 mb-8"><!-- Category Distribution -->
         <div class="glass-effect rounded-2xl p-6">
          <h3 class="text-lg font-semibold mb-6">Cursos por Categor√≠a</h3>
          <div class="space-y-4">
           <div>
            <div class="flex justify-between text-sm mb-2"><span>Marketing Digital</span> <span id="cat-marketing-count">0 inscritos</span>
            </div>
            <div class="h-4 bg-white/10 rounded-full overflow-hidden">
             <div id="cat-marketing-bar" class="h-full bg-gradient-to-r from-orange-500 to-red-500" style="width: 0%"></div>
            </div>
           </div>
           <div>
            <div class="flex justify-between text-sm mb-2"><span>Programaci√≥n</span> <span id="cat-programming-count">0 inscritos</span>
            </div>
            <div class="h-4 bg-white/10 rounded-full overflow-hidden">
             <div id="cat-programming-bar" class="h-full bg-gradient-to-r from-blue-500 to-cyan-500" style="width: 0%"></div>
            </div>
           </div>
           <div>
            <div class="flex justify-between text-sm mb-2"><span>Arte y Dise√±o</span> <span id="cat-art-count">0 inscritos</span>
            </div>
            <div class="h-4 bg-white/10 rounded-full overflow-hidden">
             <div id="cat-art-bar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500" style="width: 0%"></div>
            </div>
           </div>
           <div>
            <div class="flex justify-between text-sm mb-2"><span>Producci√≥n Visual</span> <span id="cat-visual-count">0 inscritos</span>
            </div>
            <div class="h-4 bg-white/10 rounded-full overflow-hidden">
             <div id="cat-visual-bar" class="h-full bg-gradient-to-r from-green-500 to-emerald-500" style="width: 0%"></div>
            </div>
           </div>
          </div>
         </div><!-- Completion Rate -->
         <div class="glass-effect rounded-2xl p-6">
          <h3 class="text-lg font-semibold mb-6">Tasa de Finalizaci√≥n</h3>
          <div class="flex items-center justify-center">
           <div class="relative w-48 h-48">
            <svg class="w-full h-full transform -rotate-90"><circle cx="96" cy="96" r="84" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="16" /> <circle id="completion-rate-circle" cx="96" cy="96" r="84" fill="none" stroke="url(#completionGradient)" stroke-width="16" stroke-linecap="round" stroke-dasharray="528" stroke-dashoffset="528" /> <defs>
              <lineargradient id="completionGradient" x1="0%" y1="0%" x2="100%" y2="0%">
               <stop offset="0%" stop-color="#10b981" />
               <stop offset="100%" stop-color="#34d399" />
              </lineargradient>
             </defs>
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center"><span id="completion-rate-percent" class="text-4xl font-bold">0%</span> <span class="text-sm text-gray-400">Completados</span>
            </div>
           </div>
          </div>
         </div>
        </div><!-- Recent Activity -->
        <div class="glass-effect rounded-2xl p-6">
         <h3 class="text-lg font-semibold mb-6">Actividad Reciente</h3>
         <div id="recent-activity" class="space-y-4">
          <div class="text-center text-gray-400 py-8">
           <div class="text-4xl mb-3">
            üìä
           </div>
           <p>La actividad se mostrar√° aqu√≠ a medida que los usuarios interact√∫en con la plataforma.</p>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- PAYMENT SUCCESS -->
     <div id="page-payment-success" class="page hidden">
      <div class="min-h-[calc(100%-4rem)] flex items-center justify-center py-12 px-4">
       <div class="max-w-2xl w-full">
        <div class="glass-effect rounded-3xl p-8 animate-fade-in">
         <div class="text-center mb-8">
          <div class="w-20 h-20 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-6">
           <svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
           </svg>
          </div>
          <h1 class="font-display text-3xl font-bold mb-2">¬°Pago Exitoso!</h1>
          <p class="text-gray-400 mb-2">Tu compra ha sido procesada correctamente</p>
          <p class="text-sm text-gray-500" id="success-invoice-number">Factura: #000000</p>
         </div><!-- Invoice Preview -->
         <div id="invoice-preview" class="bg-white text-gray-900 rounded-xl p-8 mb-8"><!-- Invoice will be rendered here -->
         </div>
         <div id="purchased-courses-summary" class="bg-white/5 rounded-xl p-4 mb-6 text-left"><!-- Summary will be rendered here -->
         </div>
         <p class="text-sm text-gray-400 mb-6">Los cursos ya est√°n disponibles en tu dashboard</p>
         <div class="flex flex-col sm:flex-row gap-3 justify-center"><button onclick="downloadInvoice()" class="px-6 py-3 btn-primary rounded-xl flex items-center justify-center gap-2">
           <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
           </svg> Descargar Factura </button> <button onclick="navigateTo('dashboard')" class="px-6 py-3 btn-secondary rounded-xl">Ir al Dashboard</button> <button onclick="navigateTo('courses')" class="px-6 py-3 btn-secondary rounded-xl">Ver M√°s Cursos</button>
         </div>
        </div>
       </div>
      </div>
     </div><!-- PAYMENT HISTORY PAGE -->
     <div id="page-payment-history" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-4xl mx-auto">
        <div class="flex items-center justify-between mb-8">
         <h1 class="font-display text-3xl font-bold">Historial de Pagos</h1><button onclick="navigateTo('profile')" class="flex items-center gap-2 text-gray-400 hover:text-white">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg> Volver </button>
        </div>
        <div id="payments-list" class="space-y-4"><!-- Payments will be rendered here -->
        </div>
        <div id="no-payments" class="glass-effect rounded-2xl p-8 text-center hidden">
         <div class="text-4xl mb-3">
          üí≥
         </div>
         <p class="text-gray-400">A√∫n no tienes pagos registrados</p>
        </div>
       </div>
      </div>
     </div><!-- PAYMENT METHOD MANAGER PAGE -->
     <div id="page-payment-methods" class="page hidden">
      <div class="py-8 px-4">
       <div class="max-w-4xl mx-auto">
        <div class="flex items-center justify-between mb-8">
         <h1 class="font-display text-3xl font-bold">M√©todos de Pago</h1><button onclick="navigateTo('profile')" class="flex items-center gap-2 text-gray-400 hover:text-white">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg> Volver </button>
        </div>
        <div class="glass-effect rounded-3xl p-8 mb-8">
         <h2 class="text-xl font-semibold mb-6">Editar M√©todos de Pago Preferidos</h2>
         <form id="payment-methods-form" onsubmit="savePaymentMethods(event)" class="space-y-6"><!-- Pago M√≥vil -->
          <div class="border border-white/10 rounded-2xl p-6">
           <div class="flex items-center gap-3 mb-4"><span class="text-2xl">üì±</span>
            <h3 class="text-lg font-semibold">Pago M√≥vil</h3>
           </div>
           <div class="space-y-4">
            <div><label class="block text-sm text-gray-400 mb-2">Banco</label> <input type="text" id="pago-movil-banco" class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="Ej: Banesco">
            </div>
            <div><label class="block text-sm text-gray-400 mb-2">N√∫mero de Tel√©fono</label> <input type="text" id="pago-movil-phone" class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="Ej: 0414-1234567">
            </div>
            <div><label class="block text-sm text-gray-400 mb-2">C√©dula (para Pago M√≥vil)</label> <input type="text" id="pago-movil-cedula" class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="V-12345678">
            </div>
           </div>
          </div><!-- Transferencia Bancaria -->
          <div class="border border-white/10 rounded-2xl p-6">
           <div class="flex items-center gap-3 mb-4"><span class="text-2xl">üè¶</span>
            <h3 class="text-lg font-semibold">Transferencia Bancaria</h3>
           </div>
           <div class="space-y-4">
            <div><label class="block text-sm text-gray-400 mb-2">Banco</label> <input type="text" id="transferencia-banco" class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="Ej: Banesco">
            </div>
            <div><label class="block text-sm text-gray-400 mb-2">N√∫mero de Cuenta</label> <input type="text" id="transferencia-cuenta" class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="0134-0123-45-1234567890">
            </div>
            <div><label class="block text-sm text-gray-400 mb-2">RIF</label> <input type="text" id="transferencia-rif" class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="J-12345678-9">
            </div>
           </div>
          </div><!-- PayPal -->
          <div class="border border-white/10 rounded-2xl p-6">
           <div class="flex items-center gap-3 mb-4"><span class="text-2xl">üí≥</span>
            <h3 class="text-lg font-semibold">PayPal</h3>
           </div>
           <div class="space-y-4">
            <div><label class="block text-sm text-gray-400 mb-2">Email de PayPal</label> <input type="email" id="paypal-email-method" class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="tu@email.com">
            </div>
           </div>
          </div><!-- Divisas -->
          <div class="border border-white/10 rounded-2xl p-6">
           <div class="flex items-center gap-3 mb-4"><span class="text-2xl">üíµ</span>
            <h3 class="text-lg font-semibold">Divisas (Zelle)</h3>
           </div>
           <div class="space-y-4">
            <div><label class="block text-sm text-gray-400 mb-2">Email Zelle</label> <input type="email" id="zelle-email" class="w-full px-4 py-3 rounded-xl input-style text-white" placeholder="tu@email.com">
            </div>
           </div>
          </div><button type="submit" class="w-full py-4 btn-primary rounded-xl text-lg font-semibold">Guardar Cambios</button>
         </form>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="fixed bottom-4 right-4 transform translate-y-20 opacity-0 transition-all duration-300 z-50">
    <div class="glass-effect rounded-xl px-6 py-4 flex items-center gap-3"><span id="toast-icon" class="text-2xl">‚úÖ</span> <span id="toast-message" class="text-sm">Mensaje</span>
    </div>
   </div>
  </div>
  <script>
    // ==================== APP STATE ====================
    const defaultConfig = {
      platform_name: 'NextLevel Academy',
      hero_title: 'Eleva tu potencial al siguiente nivel',
      hero_subtitle: 'Cursos premium de marketing, arte, programaci√≥n y m√°s. Aprende de los mejores expertos y transforma tu carrera.',
      primary_color: '#6366f1',
      secondary_color: '#8b5cf6',
      background_color: '#0f0f23',
      text_color: '#ffffff',
      accent_color: '#10b981'
    };

    let config = { ...defaultConfig };
    let currentUser = null;
    let cart = [];
    let allData = [];
    let currentCourse = null;
    let currentQuiz = null;
    let selectedPaymentMethod = null;
    let selectedRating = 0;
    let selectedCourseRating = 0;
    let videoInterval = null;
    let quizTimer = null;
    let quizTimeLeft = 300;
    let lastInvoice = null;
    let paymentMethods = {};

    // ==================== COURSES DATA ====================
    const courses = [
      { id: 'mkt1', title: 'Marketing Digital Avanzado', category: 'marketing', price: 49.99, duration: '8 horas', lessons: 12, instructor: 'Mar√≠a Garc√≠a', rating: 4.8, students: 1250, emoji: 'üìà', description: 'Domina las estrategias de marketing digital m√°s efectivas del mercado actual.' },
      { id: 'mkt2', title: 'SEO y Posicionamiento Web', category: 'marketing', price: 39.99, duration: '6 horas', lessons: 10, instructor: 'Carlos L√≥pez', rating: 4.7, students: 980, emoji: 'üîç', description: 'Aprende a posicionar sitios web en los primeros resultados de Google.' },
      { id: 'mkt3', title: 'Redes Sociales para Negocios', category: 'marketing', price: 34.99, duration: '5 horas', lessons: 8, instructor: 'Ana Mart√≠nez', rating: 4.9, students: 1520, emoji: 'üì±', description: 'Estrategias efectivas para hacer crecer tu negocio en redes sociales.' },
      { id: 'prog1', title: 'JavaScript desde Cero', category: 'programming', price: 59.99, duration: '15 horas', lessons: 25, instructor: 'Pedro S√°nchez', rating: 4.9, students: 2100, emoji: 'üíª', description: 'Aprende JavaScript desde los fundamentos hasta conceptos avanzados.' },
      { id: 'prog2', title: 'Python para Data Science', category: 'programming', price: 69.99, duration: '20 horas', lessons: 30, instructor: 'Laura Torres', rating: 4.8, students: 1800, emoji: 'üêç', description: 'Domina Python y sus aplicaciones en ciencia de datos.' },
      { id: 'prog3', title: 'React.js Profesional', category: 'programming', price: 54.99, duration: '12 horas', lessons: 18, instructor: 'Diego Ruiz', rating: 4.7, students: 1450, emoji: '‚öõÔ∏è', description: 'Crea aplicaciones web modernas con React.js.' },
      { id: 'art1', title: 'Ilustraci√≥n Digital', category: 'art', price: 44.99, duration: '10 horas', lessons: 15, instructor: 'Sof√≠a Hern√°ndez', rating: 4.9, students: 890, emoji: 'üé®', description: 'T√©cnicas profesionales de ilustraci√≥n digital.' },
      { id: 'art2', title: 'Dise√±o Gr√°fico con Canva', category: 'art', price: 29.99, duration: '4 horas', lessons: 8, instructor: 'Miguel √Ångel', rating: 4.6, students: 2300, emoji: '‚ú®', description: 'Crea dise√±os profesionales sin experiencia previa.' },
      { id: 'art3', title: 'Fotograf√≠a Creativa', category: 'art', price: 49.99, duration: '8 horas', lessons: 12, instructor: 'Isabella Cruz', rating: 4.8, students: 760, emoji: 'üì∑', description: 'Domina la composici√≥n y t√©cnicas de fotograf√≠a creativa.' },
      { id: 'vis1', title: 'Edici√≥n de Video con Premiere', category: 'visual', price: 64.99, duration: '14 horas', lessons: 20, instructor: 'Roberto Vargas', rating: 4.8, students: 1100, emoji: 'üé¨', description: 'Edici√≥n profesional de video con Adobe Premiere Pro.' },
      { id: 'vis2', title: 'Motion Graphics con After Effects', category: 'visual', price: 74.99, duration: '18 horas', lessons: 24, instructor: 'Carmen Delgado', rating: 4.9, students: 680, emoji: 'üé≠', description: 'Crea animaciones y efectos visuales impactantes.' },
      { id: 'vis3', title: 'Producci√≥n de Contenido para YouTube', category: 'visual', price: 39.99, duration: '6 horas', lessons: 10, instructor: 'Andr√©s Moreno', rating: 4.7, students: 1900, emoji: '‚ñ∂Ô∏è', description: 'Todo lo que necesitas para crear contenido exitoso en YouTube.' }
    ];

    // ==================== QUIZ DATA ====================
    const quizQuestions = [
      { question: '¬øCu√°l es el objetivo principal de este curso?', options: ['Aprender fundamentos', 'Dominar t√©cnicas avanzadas', 'Ambas anteriores', 'Ninguna'], correct: 2 },
      { question: '¬øQu√© herramienta es esencial para este tema?', options: ['Creatividad', 'Pr√°ctica constante', 'Conocimiento te√≥rico', 'Todas las anteriores'], correct: 3 },
      { question: '¬øCu√°l es la mejor pr√°ctica recomendada?', options: ['Estudiar todos los d√≠as', 'Practicar con proyectos reales', 'Revisar el material regularmente', 'Todas las anteriores'], correct: 3 },
      { question: '¬øQu√© factor es m√°s importante para el √©xito?', options: ['Dedicaci√≥n', 'Recursos', 'Tiempo', 'Todas son importantes'], correct: 3 },
      { question: '¬øC√≥mo aplicar√≠as lo aprendido?', options: ['En proyectos personales', 'En trabajo profesional', 'Ambos contextos', 'Solo teor√≠a'], correct: 2 }
    ];

    // ==================== DATA SDK HANDLER ====================
    const dataHandler = {
      onDataChanged(data) {
        allData = data || [];
        updateUIFromData();
      }
    };

    function updateUIFromData() {
      updateMetrics();
      updateReviews();
      if (currentUser) {
        updateDashboard();
        updateProfile();
      }
    }

    // ==================== ELEMENT SDK ====================
    function onConfigChange(cfg) {
      config = { ...defaultConfig, ...cfg };
      
      const platformName = document.getElementById('nav-platform-name');
      if (platformName) platformName.textContent = config.platform_name || defaultConfig.platform_name;
      
      const heroTitle = document.getElementById('hero-title');
      if (heroTitle) heroTitle.textContent = config.hero_title || defaultConfig.hero_title;
      
      const heroSubtitle = document.getElementById('hero-subtitle');
      if (heroSubtitle) heroSubtitle.textContent = config.hero_subtitle || defaultConfig.hero_subtitle;
    }

    function mapToCapabilities(cfg) {
      return {
        recolorables: [
          {
            get: () => cfg.primary_color || defaultConfig.primary_color,
            set: (value) => { cfg.primary_color = value; window.elementSdk.setConfig({ primary_color: value }); }
          },
          {
            get: () => cfg.background_color || defaultConfig.background_color,
            set: (value) => { cfg.background_color = value; window.elementSdk.setConfig({ background_color: value }); }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(cfg) {
      return new Map([
        ['platform_name', cfg.platform_name || defaultConfig.platform_name],
        ['hero_title', cfg.hero_title || defaultConfig.hero_title],
        ['hero_subtitle', cfg.hero_subtitle || defaultConfig.hero_subtitle]
      ]);
    }

    // ==================== INITIALIZATION ====================
    async function initApp() {
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }

      // Initialize Data SDK
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      }

      // Load saved session
      const savedUser = localStorage.getItem('currentUser');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        updateAuthUI();
      }

      // Load cart
      const savedCart = localStorage.getItem('cart');
      if (savedCart) {
        cart = JSON.parse(savedCart);
        updateCartCount();
      }

      // Render initial content
      renderFeaturedCourses();
      renderCoursesGrid();
      
      // Hide loading screen
      setTimeout(() => {
        document.getElementById('loading-screen').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
      }, 1000);
    }

    // ==================== NAVIGATION ====================
    function navigateTo(page) {
      // Hide all pages
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      
      // Show target page
      const targetPage = document.getElementById(`page-${page}`);
      if (targetPage) {
        targetPage.classList.remove('hidden');
        window.scrollTo(0, 0);
      }

      // Special page handlers
      if (page === 'cart') updateCartUI();
      if (page === 'checkout') updateCheckoutUI();
      if (page === 'payment-methods') loadPaymentMethods();
      if (page === 'payment-history') updatePaymentHistoryUI();
      if (page === 'dashboard' && currentUser) {
        updateDashboard();
      }
      if (page === 'profile' && currentUser) {
        updateProfile();
      }
      if (page === 'reviews') {
        updateReviewsUI();
      }
      if (page === 'metrics') {
        updateMetrics();
      }
    }

    // ==================== AUTH FUNCTIONS ====================
    async function handleRegister(e) {
      e.preventDefault();
      const name = document.getElementById('register-name').value.trim();
      const lastname = document.getElementById('register-lastname').value.trim();
      const cedula = document.getElementById('register-cedula').value.trim();
      const password = document.getElementById('register-password').value;
      const confirm = document.getElementById('register-confirm').value;
      const errorEl = document.getElementById('register-error');
      const successEl = document.getElementById('register-success');
      const submitBtn = document.getElementById('register-submit');

      errorEl.classList.add('hidden');
      successEl.classList.add('hidden');

      if (password !== confirm) {
        errorEl.textContent = 'Las contrase√±as no coinciden';
        errorEl.classList.remove('hidden');
        return;
      }

      // Check if user exists
      const existingUser = allData.find(d => d.type === 'user' && d.cedula === cedula);
      if (existingUser) {
        errorEl.textContent = 'Ya existe una cuenta con esta c√©dula';
        errorEl.classList.remove('hidden');
        return;
      }

      submitBtn.disabled = true;
      document.getElementById('register-btn-text').textContent = 'Registrando...';

      if (window.dataSdk && allData.filter(d => d.type === 'user').length < 999) {
        const result = await window.dataSdk.create({
          type: 'user',
          user_id: `user_${Date.now()}`,
          name,
          lastname,
          cedula,
          password,
          created_at: new Date().toISOString()
        });

        if (result.isOk) {
          successEl.textContent = '¬°Cuenta creada exitosamente! Ahora puedes iniciar sesi√≥n.';
          successEl.classList.remove('hidden');
          document.getElementById('register-form').reset();
          setTimeout(() => navigateTo('login'), 2000);
        } else {
          errorEl.textContent = 'Error al crear la cuenta. Intenta de nuevo.';
          errorEl.classList.remove('hidden');
        }
      } else {
        // Fallback without SDK
        successEl.textContent = '¬°Cuenta creada! Inicia sesi√≥n para continuar.';
        successEl.classList.remove('hidden');
        setTimeout(() => navigateTo('login'), 2000);
      }

      submitBtn.disabled = false;
      document.getElementById('register-btn-text').textContent = 'Crear Cuenta';
    }

    async function handleLogin(e) {
      e.preventDefault();
      const cedula = document.getElementById('login-cedula').value.trim();
      const password = document.getElementById('login-password').value;
      const errorEl = document.getElementById('login-error');
      const submitBtn = document.getElementById('login-submit');

      errorEl.classList.add('hidden');
      submitBtn.disabled = true;
      document.getElementById('login-btn-text').textContent = 'Iniciando...';

      // Find user
      const user = allData.find(d => d.type === 'user' && d.cedula === cedula && d.password === password);

      if (user) {
        currentUser = user;
        localStorage.setItem('currentUser', JSON.stringify(user));
        updateAuthUI();
        showToast('¬°Bienvenido de vuelta!', 'üëã');
        navigateTo('dashboard');
      } else {
        // Demo login for testing
        if (cedula && password.length >= 6) {
          currentUser = {
            user_id: `demo_${Date.now()}`,
            name: 'Usuario',
            lastname: 'Demo',
            cedula,
            created_at: new Date().toISOString()
          };
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          updateAuthUI();
          showToast('Sesi√≥n iniciada (modo demo)', 'üëã');
          navigateTo('dashboard');
        } else {
          errorEl.textContent = 'C√©dula o contrase√±a incorrectos';
          errorEl.classList.remove('hidden');
        }
      }

      submitBtn.disabled = false;
      document.getElementById('login-btn-text').textContent = 'Iniciar Sesi√≥n';
    }

    function logout() {
      currentUser = null;
      localStorage.removeItem('currentUser');
      updateAuthUI();
      showToast('Sesi√≥n cerrada', 'ÔøΩÔøΩÔøΩÔøΩ');
      navigateTo('home');
    }

    function updateAuthUI() {
      const authButtons = document.getElementById('auth-buttons');
      const userMenu = document.getElementById('user-menu');

      if (currentUser) {
        authButtons.classList.add('hidden');
        userMenu.classList.remove('hidden');
        userMenu.classList.add('flex');
        document.getElementById('user-initial').textContent = currentUser.name?.charAt(0).toUpperCase() || 'U';
        document.getElementById('user-name-nav').textContent = currentUser.name || 'Usuario';
      } else {
        authButtons.classList.remove('hidden');
        userMenu.classList.add('hidden');
        userMenu.classList.remove('flex');
      }
    }

    // ==================== COURSE FUNCTIONS ====================
    function renderFeaturedCourses() {
      const container = document.getElementById('featured-courses');
      const featured = courses.slice(0, 6);
      container.innerHTML = featured.map(course => createCourseCard(course)).join('');
    }

    function renderCoursesGrid(filter = 'all') {
      const container = document.getElementById('courses-grid');
      const filtered = filter === 'all' ? courses : courses.filter(c => c.category === filter);
      container.innerHTML = filtered.map(course => createCourseCard(course)).join('');
      
      // Update filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('tab-active');
        btn.classList.add('btn-secondary');
        if (btn.dataset.filter === filter) {
          btn.classList.add('tab-active');
          btn.classList.remove('btn-secondary');
        }
      });
    }

    function filterCourses(category) {
      navigateTo('courses');
      renderCoursesGrid(category);
    }

    function createCourseCard(course) {
      const inCart = cart.some(c => c.id === course.id);
      const owned = currentUser && allData.some(d => d.type === 'enrollment' && d.user_id === currentUser.user_id && d.course_id === course.id);
      
      return `
        <div class="glass-effect rounded-2xl overflow-hidden card-hover animate-fade-in">
          <div class="h-40 bg-gradient-to-br from-indigo-600/30 to-purple-600/30 flex items-center justify-center">
            <span class="text-6xl">${course.emoji}</span>
          </div>
          <div class="p-5">
            <div class="flex items-center gap-2 mb-2">
              <span class="px-2 py-1 text-xs rounded-full bg-indigo-500/20 text-indigo-300 capitalize">${getCategoryLabel(course.category)}</span>
              <span class="text-yellow-400 text-sm">‚≠ê ${course.rating}</span>
            </div>
            <h3 class="font-semibold text-lg mb-2 line-clamp-2">${course.title}</h3>
            <p class="text-gray-400 text-sm mb-3 line-clamp-2">${course.description}</p>
            <div class="flex items-center gap-4 text-sm text-gray-400 mb-4">
              <span>‚è±Ô∏è ${course.duration}</span>
              <span>üìñ ${course.lessons} lecciones</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-2xl font-bold">$${course.price}</span>
              ${owned 
                ? `<button onclick="openCourse('${course.id}')" class="px-4 py-2 bg-green-500/20 text-green-400 rounded-xl text-sm">Ir al Curso</button>`
                : inCart 
                  ? `<button onclick="removeFromCart('${course.id}')" class="px-4 py-2 bg-red-500/20 text-red-400 rounded-xl text-sm">Quitar</button>`
                  : `<button onclick="addToCart('${course.id}')" class="px-4 py-2 btn-primary rounded-xl text-sm">A√±adir</button>`
              }
            </div>
          </div>
        </div>
      `;
    }

    function getCategoryLabel(cat) {
      const labels = { marketing: 'Marketing', programming: 'Programaci√≥n', art: 'Arte', visual: 'Visual' };
      return labels[cat] || cat;
    }

    // ==================== CART FUNCTIONS ====================
    function addToCart(courseId) {
      const course = courses.find(c => c.id === courseId);
      if (course && !cart.some(c => c.id === courseId)) {
        cart.push(course);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        showToast('Curso a√±adido al carrito', 'üõí');
        renderFeaturedCourses();
        renderCoursesGrid();
      }
    }

    function removeFromCart(courseId) {
      cart = cart.filter(c => c.id !== courseId);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      updateCartUI();
      showToast('Curso eliminado del carrito', 'üóëÔ∏è');
      renderFeaturedCourses();
      renderCoursesGrid();
    }

    function updateCartCount() {
      const countEl = document.getElementById('cart-count');
      if (cart.length > 0) {
        countEl.textContent = cart.length;
        countEl.classList.remove('hidden');
      } else {
        countEl.classList.add('hidden');
      }
    }

    function updateCartUI() {
      const emptyEl = document.getElementById('cart-empty');
      const contentEl = document.getElementById('cart-content');
      const itemsEl = document.getElementById('cart-items');

      if (cart.length === 0) {
        emptyEl.classList.remove('hidden');
        contentEl.classList.add('hidden');
      } else {
        emptyEl.classList.add('hidden');
        contentEl.classList.remove('hidden');

        itemsEl.innerHTML = cart.map(course => `
          <div class="glass-effect rounded-xl p-4 flex items-center gap-4">
            <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-indigo-600/30 to-purple-600/30 flex items-center justify-center flex-shrink-0">
              <span class="text-2xl">${course.emoji}</span>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-semibold truncate">${course.title}</h3>
              <p class="text-sm text-gray-400">${course.duration} ‚Ä¢ ${course.lessons} lecciones</p>
            </div>
            <div class="text-right">
              <div class="font-bold">$${course.price}</div>
              <button onclick="removeFromCart('${course.id}')" class="text-red-400 text-sm hover:text-red-300">Eliminar</button>
            </div>
          </div>
        `).join('');

        const subtotal = cart.reduce((sum, c) => sum + c.price, 0);
        document.getElementById('cart-subtotal').textContent = `$${subtotal.toFixed(2)}`;
      }
    }

    // ==================== CHECKOUT FUNCTIONS ====================
    function updateCheckoutUI() {
      if (!currentUser) {
        showToast('Inicia sesi√≥n para continuar', '‚ö†Ô∏è');
        navigateTo('login');
        return;
      }

      const itemsEl = document.getElementById('checkout-items');
      itemsEl.innerHTML = cart.map(course => `
        <div class="flex items-center gap-3 p-3 bg-white/5 rounded-xl">
          <span class="text-2xl">${course.emoji}</span>
          <div class="flex-1 min-w-0">
            <div class="font-medium truncate">${course.title}</div>
          </div>
          <div class="font-bold">$${course.price}</div>
        </div>
      `).join('');

      const subtotal = cart.reduce((sum, c) => sum + c.price, 0);
      document.getElementById('checkout-subtotal').textContent = `$${subtotal.toFixed(2)}`;
      document.getElementById('checkout-total').textContent = `$${subtotal.toFixed(2)}`;

      // Pre-fill user data
      if (currentUser) {
        document.getElementById('checkout-name').value = currentUser.name || '';
        document.getElementById('checkout-lastname').value = currentUser.lastname || '';
        document.getElementById('checkout-cedula').value = currentUser.cedula || '';
      }
    }

    function selectPaymentMethod(method) {
      selectedPaymentMethod = method;
      
      // Update button states
      document.querySelectorAll('.payment-method').forEach(btn => {
        btn.classList.remove('ring-2', 'ring-indigo-500');
        if (btn.dataset.method === method) {
          btn.classList.add('ring-2', 'ring-indigo-500');
        }
      });

      // Show payment details
      document.getElementById('payment-details').classList.remove('hidden');
      document.querySelectorAll('.payment-detail').forEach(el => el.classList.add('hidden'));
      document.getElementById(`${method.replace('_', '-')}-details`).classList.remove('hidden');

      // Enable submit button
      document.getElementById('checkout-submit').disabled = false;
      document.getElementById('checkout-btn-text').textContent = 'Confirmar Pago';
    }

    async function processPayment(e) {
      e.preventDefault();
      
      if (!selectedPaymentMethod) return;

      const submitBtn = document.getElementById('checkout-submit');
      submitBtn.disabled = true;
      document.getElementById('checkout-btn-text').textContent = 'Procesando...';

      // Simulate payment processing
      await new Promise(resolve => setTimeout(resolve, 2000));

      // Generate invoice
      const invoiceNumber = `NLA-${Date.now().toString().slice(-8)}`;
      const subtotal = cart.reduce((sum, c) => sum + c.price, 0);

      lastInvoice = {
        invoiceNumber,
        date: new Date().toISOString(),
        buyer: {
          name: document.getElementById('checkout-name').value,
          lastname: document.getElementById('checkout-lastname').value,
          cedula: document.getElementById('checkout-cedula').value
        },
        paymentMethod: selectedPaymentMethod,
        items: cart,
        subtotal,
        total: subtotal,
        courses: cart.map(c => ({ id: c.id, title: c.title, price: c.price }))
      };

      // Create enrollments for each course
      if (window.dataSdk) {
        for (const course of cart) {
          const enrollmentCount = allData.filter(d => d.type === 'enrollment').length;
          if (enrollmentCount < 999) {
            await window.dataSdk.create({
              type: 'enrollment',
              user_id: currentUser.user_id,
              course_id: course.id,
              course_title: course.title,
              progress: 0,
              status: 'not_started',
              score: 0,
              created_at: new Date().toISOString()
            });
          }
        }

        // Save payment record
        const paymentCount = allData.filter(d => d.type === 'payment').length;
        if (paymentCount < 999) {
          await window.dataSdk.create({
            type: 'payment',
            user_id: currentUser.user_id,
            invoice_number: invoiceNumber,
            payment_method: selectedPaymentMethod,
            payment_reference: `${selectedPaymentMethod}_${Date.now()}`,
            total_amount: subtotal,
            created_at: new Date().toISOString()
          });
        }
      }

      // Render invoice
      renderInvoice(lastInvoice);

      // Show success
      document.getElementById('purchased-courses-summary').innerHTML = `
        <div class="space-y-2">
          ${cart.map(c => `
            <div class="flex items-center gap-2">
              <span class="text-xl">${c.emoji}</span>
              <span class="text-sm">${c.title}</span>
            </div>
          `).join('')}
        </div>
      `;

      // Clear cart
      cart = [];
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      
      showToast('¬°Pago exitoso!', '‚úÖ');
      navigateTo('payment-success');

      submitBtn.disabled = false;
      document.getElementById('checkout-btn-text').textContent = 'Confirmar Pago';
    }

    // ==================== DASHBOARD FUNCTIONS ====================
    function updateDashboard() {
      if (!currentUser) return;

      document.getElementById('dashboard-user-name').textContent = currentUser.name || 'Usuario';

      const userEnrollments = allData.filter(d => d.type === 'enrollment' && d.user_id === currentUser.user_id);
      
      const inProgress = userEnrollments.filter(e => e.status === 'in_progress').length;
      const completed = userEnrollments.filter(e => e.status === 'completed').length;
      const notStarted = userEnrollments.filter(e => e.status === 'not_started').length;
      const avgScore = completed > 0 
        ? Math.round(userEnrollments.filter(e => e.status === 'completed').reduce((sum, e) => sum + (e.score || 0), 0) / completed)
        : 0;

      document.getElementById('stat-in-progress').textContent = inProgress;
      document.getElementById('stat-completed').textContent = completed;
      document.getElementById('stat-not-started').textContent = notStarted;
      document.getElementById('stat-avg-score').textContent = `${avgScore}%`;

      renderDashboardCourses('all');
    }

    function filterDashboardCourses(filter) {
      // Update tabs
      document.querySelectorAll('.dashboard-tab').forEach(tab => {
        tab.classList.remove('tab-active');
        tab.classList.add('btn-secondary');
        if (tab.dataset.tab === filter) {
          tab.classList.add('tab-active');
          tab.classList.remove('btn-secondary');
        }
      });

      renderDashboardCourses(filter);
    }

    function renderDashboardCourses(filter) {
      if (!currentUser) return;

      let userEnrollments = allData.filter(d => d.type === 'enrollment' && d.user_id === currentUser.user_id);

      if (filter !== 'all') {
        userEnrollments = userEnrollments.filter(e => e.status === filter);
      }

      const container = document.getElementById('dashboard-courses');
      const noCoursesMsg = document.getElementById('no-courses-msg');

      if (userEnrollments.length === 0) {
        container.innerHTML = '';
        noCoursesMsg.classList.remove('hidden');
      } else {
        noCoursesMsg.classList.add('hidden');
        container.innerHTML = userEnrollments.map(enrollment => {
          const course = courses.find(c => c.id === enrollment.course_id) || { emoji: 'üìö', title: enrollment.course_title };
          const statusColors = {
            not_started: 'bg-purple-500/20 text-purple-400',
            in_progress: 'bg-indigo-500/20 text-indigo-400',
            completed: 'bg-green-500/20 text-green-400'
          };
          const statusLabels = {
            not_started: 'Por Empezar',
            in_progress: 'En Progreso',
            completed: 'Completado'
          };

          return `
            <div class="glass-effect rounded-2xl overflow-hidden card-hover">
              <div class="h-32 bg-gradient-to-br from-indigo-600/30 to-purple-600/30 flex items-center justify-center relative">
                <span class="text-5xl">${course.emoji}</span>
                <span class="absolute top-3 right-3 px-2 py-1 text-xs rounded-full ${statusColors[enrollment.status]}">${statusLabels[enrollment.status]}</span>
              </div>
              <div class="p-4">
                <h3 class="font-semibold mb-2 line-clamp-2">${course.title}</h3>
                <div class="mb-3">
                  <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-400">Progreso</span>
                    <span>${enrollment.progress || 0}%</span>
                  </div>
                  <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-indigo-500 to-purple-500" style="width: ${enrollment.progress || 0}%"></div>
                  </div>
                </div>
                ${enrollment.status === 'completed' 
                  ? `<div class="text-sm text-gray-400 mb-3">Calificaci√≥n: <span class="text-green-400 font-bold">${enrollment.score}%</span></div>`
                  : ''
                }
                <button onclick="openCourse('${enrollment.course_id}')" class="w-full py-2 btn-primary rounded-xl text-sm">
                  ${enrollment.status === 'not_started' ? 'Comenzar' : enrollment.status === 'completed' ? 'Revisar' : 'Continuar'}
                </button>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    // ==================== PROFILE FUNCTIONS ====================
    function updateProfile() {
      if (!currentUser) return;

      document.getElementById('profile-initial').textContent = currentUser.name?.charAt(0).toUpperCase() || 'U';
      document.getElementById('profile-fullname').textContent = `${currentUser.name || ''} ${currentUser.lastname || ''}`;
      document.getElementById('profile-cedula').textContent = currentUser.cedula || '';
      
      const createdAt = currentUser.created_at ? new Date(currentUser.created_at) : new Date();
      document.getElementById('profile-since').textContent = createdAt.toLocaleDateString('es-ES', { year: 'numeric', month: 'long' });

      const userEnrollments = allData.filter(d => d.type === 'enrollment' && d.user_id === currentUser.user_id);
      const completedEnrollments = userEnrollments.filter(e => e.status === 'completed');

      document.getElementById('profile-total-courses').textContent = userEnrollments.length;
      document.getElementById('profile-completed-courses').textContent = completedEnrollments.length;
      
      const avgScore = completedEnrollments.length > 0
        ? Math.round(completedEnrollments.reduce((sum, e) => sum + (e.score || 0), 0) / completedEnrollments.length)
        : 0;
      document.getElementById('profile-avg-score').textContent = `${avgScore}%`;
      document.getElementById('profile-hours').textContent = `${userEnrollments.length * 5}h`;

      // Category progress
      const categories = ['marketing', 'programming', 'art', 'visual'];
      categories.forEach(cat => {
        const catCourses = courses.filter(c => c.category === cat);
        const enrolled = userEnrollments.filter(e => catCourses.some(c => c.id === e.course_id));
        const completed = enrolled.filter(e => e.status === 'completed').length;
        const progress = catCourses.length > 0 ? Math.round((completed / catCourses.length) * 100) : 0;
        
        document.getElementById(`progress-${cat}`).textContent = `${progress}%`;
        document.getElementById(`bar-${cat}`).style.width = `${progress}%`;
      });
    }

    // ==================== COURSE LEARNING FUNCTIONS ====================
    function openCourse(courseId) {
      if (!currentUser) {
        showToast('Inicia sesi√≥n para acceder al curso', '‚ö†Ô∏è');
        navigateTo('login');
        return;
      }

      const course = courses.find(c => c.id === courseId);
      const enrollment = allData.find(d => d.type === 'enrollment' && d.user_id === currentUser.user_id && d.course_id === courseId);

      if (!course || !enrollment) {
        showToast('Curso no encontrado', '‚ùå');
        return;
      }

      currentCourse = { course, enrollment };
      
      document.getElementById('course-title').textContent = course.title;
      document.getElementById('course-description').textContent = course.description;
      
      updateCourseProgress(enrollment.progress || 0);
      renderLessonsList(course, enrollment);
      
      // Reset video state
      document.getElementById('video-placeholder').classList.remove('hidden');
      document.getElementById('video-playing').classList.add('hidden');
      
      // Show appropriate buttons
      const startBtn = document.getElementById('start-lesson-btn');
      const quizBtn = document.getElementById('take-quiz-btn');
      
      if (enrollment.status === 'completed') {
        startBtn.textContent = 'Ver Lecci√≥n';
        quizBtn.classList.remove('hidden');
        quizBtn.textContent = 'Repetir Prueba';
      } else if (enrollment.progress >= 100) {
        startBtn.classList.add('hidden');
        quizBtn.classList.remove('hidden');
        quizBtn.textContent = 'Tomar Prueba';
      } else {
        startBtn.classList.remove('hidden');
        startBtn.textContent = enrollment.status === 'not_started' ? 'Iniciar Lecci√≥n' : 'Continuar Lecci√≥n';
        quizBtn.classList.add('hidden');
      }

      navigateTo('course');
    }

    function updateCourseProgress(progress) {
      document.getElementById('progress-percent').textContent = `${progress}%`;
      const circle = document.getElementById('progress-circle');
      const offset = 352 - (352 * progress / 100);
      circle.style.strokeDashoffset = offset;
    }

    function renderLessonsList(course, enrollment) {
      const lessonsContainer = document.getElementById('lessons-list');
      const lessonCount = course.lessons;
      const completedLessons = Math.floor((enrollment.progress || 0) / 100 * lessonCount);

      let html = '';
      for (let i = 1; i <= Math.min(lessonCount, 5); i++) {
        const isCompleted = i <= completedLessons;
        const isCurrent = i === completedLessons + 1;
        html += `
          <div class="flex items-center gap-3 p-3 rounded-xl ${isCurrent ? 'bg-indigo-500/20' : 'bg-white/5'}">
            <div class="w-8 h-8 rounded-full flex items-center justify-center ${isCompleted ? 'bg-green-500/20 text-green-400' : isCurrent ? 'bg-indigo-500/20 text-indigo-400' : 'bg-white/10 text-gray-400'}">
              ${isCompleted ? '‚úì' : i}
            </div>
            <span class="text-sm ${isCurrent ? 'text-white' : 'text-gray-400'}">Lecci√≥n ${i}</span>
          </div>
        `;
      }
      if (lessonCount > 5) {
        html += `<div class="text-center text-sm text-gray-400 py-2">+${lessonCount - 5} lecciones m√°s</div>`;
      }
      lessonsContainer.innerHTML = html;

      // Load course comments
      loadCourseComments(course.id);
    }

    async function startLesson() {
      if (!currentCourse) return;

      // Show video playing state
      document.getElementById('video-placeholder').classList.add('hidden');
      document.getElementById('video-playing').classList.remove('hidden');

      // Update enrollment status
      if (currentCourse.enrollment.status === 'not_started' && window.dataSdk) {
        currentCourse.enrollment.status = 'in_progress';
        await window.dataSdk.update({
          ...currentCourse.enrollment,
          status: 'in_progress'
        });
      }

      // Simulate video progress
      let progress = currentCourse.enrollment.progress || 0;
      const targetProgress = Math.min(progress + 25, 100);
      
      clearInterval(videoInterval);
      let videoProgress = 0;
      
      videoInterval = setInterval(async () => {
        videoProgress += 1;
        document.getElementById('video-progress').style.width = `${videoProgress}%`;
        
        const minutes = Math.floor((videoProgress / 100) * 5);
        const seconds = Math.floor(((videoProgress / 100) * 300) % 60);
        document.getElementById('video-time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')} / 5:00`;

        if (videoProgress >= 100) {
          clearInterval(videoInterval);
          
          // Update course progress
          if (window.dataSdk) {
            await window.dataSdk.update({
              ...currentCourse.enrollment,
              progress: targetProgress,
              status: targetProgress >= 100 ? 'in_progress' : 'in_progress'
            });
            currentCourse.enrollment.progress = targetProgress;
          }

          updateCourseProgress(targetProgress);
          renderLessonsList(currentCourse.course, currentCourse.enrollment);

          if (targetProgress >= 100) {
            document.getElementById('start-lesson-btn').classList.add('hidden');
            document.getElementById('take-quiz-btn').classList.remove('hidden');
            showToast('¬°Lecci√≥n completada! Toma la prueba.', 'üéâ');
          } else {
            showToast('¬°Progreso guardado!', '‚úÖ');
          }
        }
      }, 30);
    }

    function toggleVideo() {
      if (videoInterval) {
        clearInterval(videoInterval);
        videoInterval = null;
        document.getElementById('video-pause-btn').innerHTML = `
          <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z"/>
          </svg>
        `;
      } else {
        startLesson();
        document.getElementById('video-pause-btn').innerHTML = `
          <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24">
            <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
          </svg>
        `;
      }
    }

    // ==================== QUIZ FUNCTIONS ====================
    function startQuiz() {
      if (!currentCourse) return;

      currentQuiz = {
        courseId: currentCourse.course.id,
        courseTitle: currentCourse.course.title,
        currentQuestion: 0,
        answers: [],
        startTime: Date.now()
      };

      document.getElementById('quiz-course-title').textContent = currentCourse.course.title;
      document.getElementById('quiz-total').textContent = quizQuestions.length;
      
      quizTimeLeft = 300;
      startQuizTimer();
      renderQuestion();
      navigateTo('quiz');
    }

    function startQuizTimer() {
      clearInterval(quizTimer);
      quizTimer = setInterval(() => {
        quizTimeLeft--;
        const minutes = Math.floor(quizTimeLeft / 60);
        const seconds = quizTimeLeft % 60;
        document.getElementById('quiz-timer').textContent = `‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        if (quizTimeLeft <= 0) {
          clearInterval(quizTimer);
          submitQuiz();
        }
      }, 1000);
    }

    function renderQuestion() {
      const q = quizQuestions[currentQuiz.currentQuestion];
      document.getElementById('quiz-current').textContent = currentQuiz.currentQuestion + 1;
      document.getElementById('quiz-progress-bar').style.width = `${((currentQuiz.currentQuestion + 1) / quizQuestions.length) * 100}%`;
      document.getElementById('quiz-question').textContent = q.question;

      const optionsHtml = q.options.map((opt, idx) => `
        <button type="button" onclick="selectAnswer(${idx})" class="quiz-option w-full p-4 rounded-xl text-left btn-secondary hover:bg-indigo-500/20 transition ${currentQuiz.answers[currentQuiz.currentQuestion] === idx ? 'ring-2 ring-indigo-500 bg-indigo-500/20' : ''}">
          <span class="inline-block w-8 h-8 rounded-full bg-white/10 text-center leading-8 mr-3">${String.fromCharCode(65 + idx)}</span>
          ${opt}
        </button>
      `).join('');
      
      document.getElementById('quiz-options').innerHTML = optionsHtml;

      // Update navigation buttons
      document.getElementById('quiz-prev').disabled = currentQuiz.currentQuestion === 0;
      
      const isLast = currentQuiz.currentQuestion === quizQuestions.length - 1;
      document.getElementById('quiz-next').classList.toggle('hidden', isLast);
      document.getElementById('quiz-submit').classList.toggle('hidden', !isLast);
    }

    function selectAnswer(idx) {
      currentQuiz.answers[currentQuiz.currentQuestion] = idx;
      renderQuestion();
    }

    function prevQuestion() {
      if (currentQuiz.currentQuestion > 0) {
        currentQuiz.currentQuestion--;
        renderQuestion();
      }
    }

    function nextQuestion() {
      if (currentQuiz.currentQuestion < quizQuestions.length - 1) {
        currentQuiz.currentQuestion++;
        renderQuestion();
      }
    }

    async function submitQuiz() {
      clearInterval(quizTimer);

      // Calculate score
      let correct = 0;
      quizQuestions.forEach((q, idx) => {
        if (currentQuiz.answers[idx] === q.correct) correct++;
      });

      const score = Math.round((correct / quizQuestions.length) * 100);
      const timeUsed = Math.floor((Date.now() - currentQuiz.startTime) / 1000);
      const minutes = Math.floor(timeUsed / 60);
      const seconds = timeUsed % 60;

      // Update enrollment
      if (window.dataSdk && currentCourse) {
        await window.dataSdk.update({
          ...currentCourse.enrollment,
          status: 'completed',
          progress: 100,
          score: score,
          completed_at: new Date().toISOString()
        });
      }

      // Show results
      document.getElementById('results-course').textContent = currentQuiz.courseTitle;
      document.getElementById('results-score').textContent = `${score}%`;
      document.getElementById('results-correct').textContent = correct;
      document.getElementById('results-incorrect').textContent = quizQuestions.length - correct;
      document.getElementById('results-time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

      const circle = document.getElementById('results-circle');
      const offset = 440 - (440 * score / 100);
      setTimeout(() => circle.style.strokeDashoffset = offset, 100);

      if (score >= 70) {
        document.getElementById('results-icon').textContent = 'üéâ';
        document.getElementById('results-message').className = 'p-4 rounded-xl bg-green-500/10 text-green-400 mb-8';
        document.getElementById('results-message').textContent = '¬°Excelente trabajo! Has aprobado el curso.';
      } else {
        document.getElementById('results-icon').textContent = 'üìö';
        document.getElementById('results-message').className = 'p-4 rounded-xl bg-yellow-500/10 text-yellow-400 mb-8';
        document.getElementById('results-message').textContent = 'Sigue practicando. Puedes intentarlo de nuevo.';
      }

      navigateTo('results');
    }

    // ==================== REVIEWS FUNCTIONS ====================
    function updateReviewsUI() {
      const addSection = document.getElementById('add-review-section');
      const loginSection = document.getElementById('login-to-review');

      if (currentUser) {
        addSection.classList.remove('hidden');
        loginSection.classList.add('hidden');
      } else {
        addSection.classList.add('hidden');
        loginSection.classList.remove('hidden');
      }

      updateReviews();
    }

    function setRating(rating) {
      selectedRating = rating;
      document.querySelectorAll('#rating-input .star').forEach((star, idx) => {
        star.classList.toggle('text-yellow-400', idx < rating);
        star.classList.toggle('text-gray-500', idx >= rating);
      });
    }

    async function submitReview(e) {
      e.preventDefault();
      
      if (!currentUser || selectedRating === 0) {
        showToast('Selecciona una calificaci√≥n', '‚ö†Ô∏è');
        return;
      }

      const comment = document.getElementById('review-comment').value.trim();
      if (!comment) return;

      const submitBtn = document.getElementById('review-submit');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Enviando...';

      if (window.dataSdk) {
        const reviewCount = allData.filter(d => d.type === 'review').length;
        if (reviewCount < 999) {
          const result = await window.dataSdk.create({
            type: 'review',
            user_id: currentUser.user_id,
            name: currentUser.name,
            lastname: currentUser.lastname,
            rating: selectedRating,
            comment,
            created_at: new Date().toISOString()
          });

          if (result.isOk) {
            showToast('¬°Gracias por tu opini√≥n!', '‚≠ê');
            document.getElementById('review-form').reset();
            selectedRating = 0;
            setRating(0);
          }
        } else {
          showToast('Se ha alcanzado el l√≠mite de opiniones', '‚ö†Ô∏è');
        }
      }

      submitBtn.disabled = false;
      submitBtn.textContent = 'Enviar Opini√≥n';
    }

    function updateReviews() {
      const reviews = allData.filter(d => d.type === 'review');
      const container = document.getElementById('reviews-list');
      const noReviews = document.getElementById('no-reviews');

      if (reviews.length === 0) {
        container.innerHTML = '';
        noReviews.classList.remove('hidden');
      } else {
        noReviews.classList.add('hidden');
        
        // Calculate average
        const avgRating = reviews.reduce((sum, r) => sum + (r.rating || 0), 0) / reviews.length;
        document.getElementById('overall-rating').textContent = avgRating.toFixed(1);
        document.getElementById('total-reviews').textContent = reviews.length;

        // Update stars
        const starsHtml = Array(5).fill(0).map((_, i) => 
          `<span class="text-2xl ${i < Math.round(avgRating) ? 'text-yellow-400' : 'text-gray-600'}">‚òÖ</span>`
        ).join('');
        document.getElementById('overall-stars').innerHTML = starsHtml;

        // Update rating distribution
        for (let i = 1; i <= 5; i++) {
          const count = reviews.filter(r => r.rating === i).length;
          const percent = (count / reviews.length) * 100;
          document.getElementById(`rating-${i}-bar`).style.width = `${percent}%`;
          document.getElementById(`rating-${i}-count`).textContent = count;
        }

        // Render reviews
        container.innerHTML = reviews.sort((a, b) => new Date(b.created_at) - new Date(a.created_at)).slice(0, 10).map(review => `
          <div class="glass-effect rounded-2xl p-6 animate-fade-in">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center flex-shrink-0">
                <span class="font-bold">${(review.name || 'U').charAt(0).toUpperCase()}</span>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="font-semibold">${review.name || 'Usuario'} ${review.lastname || ''}</span>
                  <span class="text-yellow-400">${'‚òÖ'.repeat(review.rating || 0)}${'‚òÜ'.repeat(5 - (review.rating || 0))}</span>
                </div>
                <p class="text-gray-400 text-sm mb-2">${new Date(review.created_at).toLocaleDateString('es-ES')}</p>
                <p class="text-gray-300">${review.comment}</p>
              </div>
            </div>
          </div>
        `).join('');
      }
    }

    // ==================== METRICS FUNCTIONS ====================
    function updateMetrics() {
      const users = allData.filter(d => d.type === 'user');
      const enrollments = allData.filter(d => d.type === 'enrollment');
      const completions = enrollments.filter(e => e.status === 'completed');
      const reviews = allData.filter(d => d.type === 'review');

      document.getElementById('metric-users').textContent = users.length;
      document.getElementById('metric-enrollments').textContent = enrollments.length;
      document.getElementById('metric-completions').textContent = completions.length;

      const avgRating = reviews.length > 0
        ? (reviews.reduce((sum, r) => sum + (r.rating || 0), 0) / reviews.length).toFixed(1)
        : '0.0';
      document.getElementById('metric-avg-rating').textContent = avgRating;

      // Category distribution
      const categories = ['marketing', 'programming', 'art', 'visual'];
      const totalEnrollments = enrollments.length || 1;
      
      categories.forEach(cat => {
        const catCourses = courses.filter(c => c.category === cat);
        const catEnrollments = enrollments.filter(e => catCourses.some(c => c.id === e.course_id));
        const percent = (catEnrollments.length / totalEnrollments) * 100;
        
        document.getElementById(`cat-${cat}-count`).textContent = `${catEnrollments.length} inscritos`;
        document.getElementById(`cat-${cat}-bar`).style.width = `${percent}%`;
      });

      // Completion rate
      const completionRate = enrollments.length > 0
        ? Math.round((completions.length / enrollments.length) * 100)
        : 0;
      document.getElementById('completion-rate-percent').textContent = `${completionRate}%`;
      const circle = document.getElementById('completion-rate-circle');
      const offset = 528 - (528 * completionRate / 100);
      circle.style.strokeDashoffset = offset;

      // Recent activity
      const recentActivity = [...enrollments, ...reviews]
        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
        .slice(0, 5);

      if (recentActivity.length > 0) {
        document.getElementById('recent-activity').innerHTML = recentActivity.map(item => {
          const isEnrollment = item.type === 'enrollment';
          const user = allData.find(d => d.type === 'user' && d.user_id === item.user_id);
          const name = user ? `${user.name} ${user.lastname}` : 'Usuario';
          
          return `
            <div class="flex items-center gap-4 p-4 bg-white/5 rounded-xl">
              <div class="w-10 h-10 rounded-full ${isEnrollment ? 'bg-indigo-500/20' : 'bg-yellow-500/20'} flex items-center justify-center">
                ${isEnrollment ? 'üìö' : '‚≠ê'}
              </div>
              <div class="flex-1">
                <p class="text-sm"><span class="font-semibold">${name}</span> ${isEnrollment ? `se inscribi√≥ en ${item.course_title || 'un curso'}` : `dej√≥ una rese√±a de ${item.rating} estrellas`}</p>
                <p class="text-xs text-gray-400">${new Date(item.created_at).toLocaleDateString('es-ES')}</p>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    // ==================== UTILITY FUNCTIONS ====================
    function showToast(message, icon = '‚úÖ') {
      const toast = document.getElementById('toast');
      document.getElementById('toast-message').textContent = message;
      document.getElementById('toast-icon').textContent = icon;
      
      toast.classList.remove('translate-y-20', 'opacity-0');
      toast.classList.add('translate-y-0', 'opacity-100');

      setTimeout(() => {
        toast.classList.add('translate-y-20', 'opacity-0');
        toast.classList.remove('translate-y-0', 'opacity-100');
      }, 3000);
    }

    // ==================== INVOICE FUNCTIONS ====================
    function renderInvoice(invoice) {
      const invoiceHtml = `
        <div class="border-b border-gray-300 pb-4 mb-4">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h2 class="text-2xl font-bold text-gray-900">FACTURA</h2>
              <p class="text-gray-600">NextLevel Academy</p>
            </div>
            <div class="text-right">
              <p class="text-lg font-bold">#${invoice.invoiceNumber}</p>
              <p class="text-sm text-gray-600">${new Date(invoice.date).toLocaleDateString('es-ES')}</p>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6 text-sm">
          <div>
            <p class="text-gray-600 font-semibold">FACTURADO A:</p>
            <p class="text-gray-900">${invoice.buyer.name} ${invoice.buyer.lastname}</p>
            <p class="text-gray-600">C√©dula: ${invoice.buyer.cedula}</p>
          </div>
          <div>
            <p class="text-gray-600 font-semibold">INFORMACI√ìN DE PAGO:</p>
            <p class="text-gray-900">M√©todo: ${getPaymentMethodLabel(invoice.paymentMethod)}</p>
            <p class="text-gray-600">Fecha: ${new Date(invoice.date).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
          </div>
        </div>

        <table class="w-full mb-6 text-sm">
          <thead>
            <tr class="border-b-2 border-gray-900">
              <th class="text-left py-2 text-gray-900">Descripci√≥n</th>
              <th class="text-right py-2 text-gray-900">Cantidad</th>
              <th class="text-right py-2 text-gray-900">Precio</th>
              <th class="text-right py-2 text-gray-900">Total</th>
            </tr>
          </thead>
          <tbody>
            ${invoice.courses.map((course, idx) => `
              <tr class="border-b border-gray-200">
                <td class="py-3 text-gray-900">${course.title}</td>
                <td class="text-right py-3 text-gray-900">1</td>
                <td class="text-right py-3 text-gray-900">$${course.price.toFixed(2)}</td>
                <td class="text-right py-3 text-gray-900">$${course.price.toFixed(2)}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>

        <div class="flex justify-end mb-6">
          <div class="w-64">
            <div class="flex justify-between py-2 text-sm text-gray-700 border-t border-gray-300">
              <span>SUBTOTAL:</span>
              <span>$${invoice.subtotal.toFixed(2)}</span>
            </div>
            <div class="flex justify-between py-2 text-sm text-gray-700">
              <span>Impuestos:</span>
              <span>$0.00</span>
            </div>
            <div class="flex justify-between py-3 text-lg font-bold text-gray-900 border-t-2 border-gray-900">
              <span>TOTAL:</span>
              <span>$${invoice.total.toFixed(2)}</span>
            </div>
          </div>
        </div>

        <div class="text-center text-xs text-gray-600 pt-4 border-t border-gray-300">
          <p>Gracias por tu compra. Accede a tus cursos desde tu dashboard.</p>
          <p>www.nextlevelacademy.com | soporte@nextlevelacademy.com</p>
        </div>
      `;

      document.getElementById('invoice-preview').innerHTML = invoiceHtml;
      document.getElementById('success-invoice-number').textContent = `Factura: #${invoice.invoiceNumber}`;
    }

    function getPaymentMethodLabel(method) {
      const labels = {
        'pago_movil': 'Pago M√≥vil',
        'transferencia': 'Transferencia Bancaria',
        'paypal': 'PayPal',
        'divisas': 'Divisas (Zelle)'
      };
      return labels[method] || method;
    }

    function downloadInvoice() {
      if (!lastInvoice) {
        showToast('No hay factura para descargar', '‚ö†Ô∏è');
        return;
      }

      const invoiceNumber = lastInvoice.invoiceNumber;
      const htmlContent = document.getElementById('invoice-preview').innerHTML;
      
      const printWindow = window.open('', '', 'width=900,height=700');
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Factura ${invoiceNumber}</title>
          <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { font-family: Arial, sans-serif; padding: 20px; background: white; }
            .invoice { max-width: 900px; margin: 0 auto; }
            @media print {
              body { padding: 0; }
              .no-print { display: none; }
            }
            .print-btn { padding: 10px 20px; background: #4f46e5; color: white; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px; }
            .print-btn:hover { background: #4338ca; }
          </style>
        </head>
        <body>
          <button class="print-btn no-print" onclick="window.print(); setTimeout(() => window.close(), 1000)">Descargar PDF</button>
          <div class="invoice">
            ${htmlContent}
          </div>
        </body>
        </html>
      `);
      printWindow.document.close();
      
      setTimeout(() => {
        printWindow.focus();
        printWindow.print();
      }, 500);

      showToast('Abriendo vista de impresi√≥n...', 'üìÑ');
    }

    function savePaymentMethods(e) {
      e.preventDefault();

      paymentMethods = {
        pago_movil: {
          banco: document.getElementById('pago-movil-banco').value,
          phone: document.getElementById('pago-movil-phone').value,
          cedula: document.getElementById('pago-movil-cedula').value
        },
        transferencia: {
          banco: document.getElementById('transferencia-banco').value,
          cuenta: document.getElementById('transferencia-cuenta').value,
          rif: document.getElementById('transferencia-rif').value
        },
        paypal: {
          email: document.getElementById('paypal-email-method').value
        },
        divisas: {
          email: document.getElementById('zelle-email').value
        }
      };

      localStorage.setItem('paymentMethods', JSON.stringify(paymentMethods));
      showToast('M√©todos de pago guardados', '‚úÖ');
      setTimeout(() => navigateTo('profile'), 1500);
    }

    function loadPaymentMethods() {
      const saved = localStorage.getItem('paymentMethods');
      if (saved) {
        paymentMethods = JSON.parse(saved);
        
        // Populate form
        if (paymentMethods.pago_movil) {
          document.getElementById('pago-movil-banco').value = paymentMethods.pago_movil.banco || '';
          document.getElementById('pago-movil-phone').value = paymentMethods.pago_movil.phone || '';
          document.getElementById('pago-movil-cedula').value = paymentMethods.pago_movil.cedula || '';
        }
        if (paymentMethods.transferencia) {
          document.getElementById('transferencia-banco').value = paymentMethods.transferencia.banco || '';
          document.getElementById('transferencia-cuenta').value = paymentMethods.transferencia.cuenta || '';
          document.getElementById('transferencia-rif').value = paymentMethods.transferencia.rif || '';
        }
        if (paymentMethods.paypal) {
          document.getElementById('paypal-email-method').value = paymentMethods.paypal.email || '';
        }
        if (paymentMethods.divisas) {
          document.getElementById('zelle-email').value = paymentMethods.divisas.email || '';
        }
      }
    }

    function updatePaymentHistoryUI() {
      if (!currentUser) return;

      const payments = allData.filter(d => d.type === 'payment' && d.user_id === currentUser.user_id);
      const container = document.getElementById('payments-list');
      const noPayments = document.getElementById('no-payments');

      if (payments.length === 0) {
        container.innerHTML = '';
        noPayments.classList.remove('hidden');
      } else {
        noPayments.classList.add('hidden');
        
        container.innerHTML = payments.sort((a, b) => new Date(b.created_at) - new Date(a.created_at)).map(payment => {
          const enrollments = allData.filter(d => d.type === 'enrollment' && d.user_id === currentUser.user_id && new Date(d.created_at) <= new Date(payment.created_at));
          const courseCount = enrollments.length;
          
          return `
            <div class="glass-effect rounded-2xl p-6 animate-fade-in">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <span class="text-2xl">${getPaymentMethodEmoji(payment.payment_method)}</span>
                    <div>
                      <p class="font-semibold">#${payment.invoice_number}</p>
                      <p class="text-sm text-gray-400">${new Date(payment.created_at).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-400 mb-2">${getPaymentMethodLabel(payment.payment_method)} ‚Ä¢ ${courseCount} curso(s)</p>
                  <p class="text-xl font-bold text-indigo-400">$${payment.total_amount?.toFixed(2) || '0.00'}</p>
                </div>
                <div class="flex items-center gap-2">
                  <span class="px-3 py-1 rounded-full bg-green-500/20 text-green-400 text-xs font-semibold">‚úì Completado</span>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    function getPaymentMethodEmoji(method) {
      const emojis = {
        'pago_movil': 'üì±',
        'transferencia': 'üè¶',
        'paypal': 'üí≥',
        'divisas': 'üíµ'
      };
      return emojis[method] || 'üí∞';
    }

    // ==================== COURSE COMMENTS FUNCTIONS ====================
    function loadCourseComments(courseId) {
      if (!currentCourse) return;

      const comments = allData.filter(d => d.type === 'course_comment' && d.course_id === courseId);
      const container = document.getElementById('course-comments-container');
      const noComments = document.getElementById('no-comments');
      const addSection = document.getElementById('add-comment-section');
      const loginSection = document.getElementById('login-to-comment');
      const ratingSummary = document.getElementById('course-rating-summary');

      // Show/hide form based on login status
      if (currentUser) {
        addSection.classList.remove('hidden');
        loginSection.classList.add('hidden');
      } else {
        addSection.classList.add('hidden');
        loginSection.classList.remove('hidden');
      }

      // Update rating summary
      if (comments.length > 0) {
        ratingSummary.classList.remove('hidden');
        updateCourseRatingSummary(comments);
      } else {
        ratingSummary.classList.add('hidden');
      }

      // Render comments
      if (comments.length === 0) {
        container.innerHTML = '<div id="no-comments" class="text-center p-8 bg-white/5 rounded-xl"><div class="text-4xl mb-3">üí¨</div><p class="text-gray-400">A√∫n no hay comentarios en este curso</p></div>';
      } else {
        noComments.classList.add('hidden');
        container.innerHTML = comments
          .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
          .map(comment => createCommentElement(comment))
          .join('');
      }

      // Reset form
      document.getElementById('comment-form').reset();
      selectedCourseRating = 0;
      setCourseRating(0);
      updateCharCount();
    }

    function updateCourseRatingSummary(comments) {
      const avgRating = comments.reduce((sum, c) => sum + (c.rating || 0), 0) / comments.length;
      document.getElementById('course-avg-rating').textContent = avgRating.toFixed(1);
      document.getElementById('course-total-ratings').textContent = comments.length;

      // Stars
      const starsHtml = Array(5).fill(0).map((_, i) => 
        `<span class="text-2xl ${i < Math.round(avgRating) ? 'text-yellow-400' : 'text-gray-600'}">‚òÖ</span>`
      ).join('');
      document.getElementById('course-avg-stars').innerHTML = starsHtml;

      // Rating distribution bars
      let barsHtml = '';
      for (let i = 5; i >= 1; i--) {
        const count = comments.filter(c => c.rating === i).length;
        const percent = (count / comments.length) * 100;
        barsHtml += `
          <div class="flex items-center gap-2">
            <span class="text-sm w-8 text-right">${i} ‚≠ê</span>
            <div class="flex-1 h-2 bg-white/10 rounded-full overflow-hidden">
              <div class="h-full bg-yellow-400" style="width: ${percent}%"></div>
            </div>
            <span class="text-xs text-gray-400 w-8">${count}</span>
          </div>
        `;
      }
      document.getElementById('course-rating-bars').innerHTML = barsHtml;
    }

    function createCommentElement(comment) {
      const date = new Date(comment.created_at);
      const timeAgo = getTimeAgo(date);
      const isCurrentUserComment = currentUser && currentUser.user_id === comment.user_id;

      return `
        <div class="glass-effect rounded-2xl p-6 animate-fade-in">
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center flex-shrink-0">
                <span class="font-bold">${(comment.name || 'U').charAt(0).toUpperCase()}</span>
              </div>
              <div>
                <div class="font-semibold">${comment.name || 'Usuario'} ${comment.lastname || ''}</div>
                <div class="text-xs text-gray-400">${timeAgo}</div>
              </div>
            </div>
            ${isCurrentUserComment ? `
              <button onclick="deleteCourseComment('${comment.__backendId}')" class="p-2 hover:bg-red-500/20 rounded-lg text-red-400 text-sm transition">
                üóëÔ∏è
              </button>
            ` : ''}
          </div>

          <div class="flex items-center gap-1 mb-3">
            ${Array(5).fill(0).map((_, i) => 
              `<span class="text-xl ${i < comment.rating ? 'text-yellow-400' : 'text-gray-600'}">‚òÖ</span>`
            ).join('')}
          </div>

          <p class="text-gray-300 mb-2">${escapeHtml(comment.comment)}</p>
          
          ${isCurrentUserComment ? `
            <div class="text-xs text-indigo-400 flex items-center gap-1">
              ‚úì Tu comentario
            </div>
          ` : ''}
        </div>
      `;
    }

    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      if (seconds < 60) return 'Hace unos segundos';
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return `Hace ${minutes} min`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `Hace ${hours}h`;
      const days = Math.floor(hours / 24);
      if (days < 7) return `Hace ${days}d`;
      return date.toLocaleDateString('es-ES');
    }

    function escapeHtml(text) {
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return text.replace(/[&<>"']/g, m => map[m]);
    }

    function setCourseRating(rating) {
      selectedCourseRating = rating;
      document.querySelectorAll('#course-rating-input .star').forEach((star, idx) => {
        star.classList.toggle('text-yellow-400', idx < rating);
        star.classList.toggle('text-gray-500', idx >= rating);
      });
    }

    function updateCharCount() {
      const textarea = document.getElementById('course-comment-text');
      document.getElementById('char-count').textContent = textarea.value.length;
    }

    // Event listener for character count
    document.addEventListener('DOMContentLoaded', () => {
      const textarea = document.getElementById('course-comment-text');
      if (textarea) {
        textarea.addEventListener('input', updateCharCount);
      }
    });

    async function submitCourseComment(e) {
      e.preventDefault();

      if (!currentUser) {
        showToast('Inicia sesi√≥n para comentar', '‚ö†Ô∏è');
        navigateTo('login');
        return;
      }

      if (selectedCourseRating === 0) {
        showToast('Selecciona una calificaci√≥n', '‚ö†Ô∏è');
        return;
      }

      const comment = document.getElementById('course-comment-text').value.trim();
      if (!comment) return;

      const submitBtn = document.getElementById('comment-submit');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Publicando...';

      if (window.dataSdk && currentCourse) {
        const commentCount = allData.filter(d => d.type === 'course_comment').length;
        if (commentCount < 999) {
          const result = await window.dataSdk.create({
            type: 'course_comment',
            user_id: currentUser.user_id,
            course_id: currentCourse.course.id,
            course_title: currentCourse.course.title,
            name: currentUser.name,
            lastname: currentUser.lastname,
            rating: selectedCourseRating,
            comment,
            created_at: new Date().toISOString()
          });

          if (result.isOk) {
            showToast('¬°Comentario publicado!', '‚≠ê');
            loadCourseComments(currentCourse.course.id);
          } else {
            showToast('Error al publicar comentario', '‚ùå');
          }
        } else {
          showToast('Se ha alcanzado el l√≠mite de comentarios', '‚ö†Ô∏è');
        }
      }

      submitBtn.disabled = false;
      submitBtn.textContent = 'Publicar Comentario';
    }

    async function deleteCourseComment(commentId) {
      if (!confirm('¬øEst√°s seguro de que quieres eliminar tu comentario?')) return;

      const comment = allData.find(d => d.type === 'course_comment' && d.__backendId === commentId);
      
      if (window.dataSdk && comment) {
        const result = await window.dataSdk.delete(comment);
        if (result.isOk) {
          showToast('Comentario eliminado', 'üóëÔ∏è');
          if (currentCourse) {
            loadCourseComments(currentCourse.course.id);
          }
        }
      }
    }

    // ==================== START APP ====================
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c975ff461f1afd7',t:'MTc3MDM0NjU5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>